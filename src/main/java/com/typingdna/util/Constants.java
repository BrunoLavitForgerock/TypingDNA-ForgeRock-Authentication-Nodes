/*
  Copyright 2020 TypingDNA Inc. (https://www.typingdna.com)

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
*/


package com.typingdna.util;

public final class Constants {
    public static final boolean DEBUG = false;

    public static final String PATTERN_OUTPUT_VARIABLE = "TP";
    public static final String DEVICE_TYPE_OUTPUT_VARIABLE = "DEVICE_TYPE";
    public static final String TEXT_ID_OUTPUT_VARIABLE = "TEXT_ID";

    public static final String TYPING_PATTERN = "TDNA_TYPING_PATTERN";
    public static final String DEVICE_TYPE = "TDNA_DEVICE_TYPE";
    public static final String VERIFY_RETRIES = "TDNA_RETRIES";
    public static final String PATTERNS_ENROLLED = "TDNA_PATTERNS_ENROLLED";
    public static final String PREVIOUS_ACTION = "TDNA_PREVIOUS_ACTION";
    public static final String PREVIOUS_TYPING_PATTERNS = "TDNA_PREVIOUS_TYPING_PATTERNS";
    public static final String TEXT_ID = "TDNA_TEXT_ID";
    public static final String TEXT_TO_ENTER = "TDNA_TEXT_TO_ENTER";
    public static final String MESSAGE = "TDNA_MESSAGE";

    public static final String typingPatternVisualizer = "function TypingVisualizer(t){t=t||{},this.deltaX=3,this.vpMaxHeight=16,this.typingLength=7,this.vpAlpha=.5,this.timeDown=(new Date).getTime(),this.timeUp=(new Date).getTime(),this.targets={},this.showTDNALogo=void 0===t.showTDNALogo||t.showTDNALogo,this.logoHeight=16,this.scrollOffset=18,this.setStyle=function(t,e){if(void 0!==t)for(var i in e)e.hasOwnProperty(i)&&(t.style[i]=e[i])};var o=this;this.keyDown=function(t){o.timeDown=(new Date).getTime()},this.keyUp=function(t){var e,i,n,s,a=o.targets[t.target.id];void 0!==a&&(s=o.timeUp,o.timeUp=(new Date).getTime(),e=Math.min(500,o.timeUp-s)/500,n=Math.min(180,o.timeUp-o.timeDown)/180,8==t.keyCode||46==t.keyCode?a.deleteKeyData():13!=t.keyCode&&9!=t.keyCode&&(i=2+Math.round(e*(.8*o.vpMaxHeight)),(s=o.vpMaxHeight-i)<(t=Math.round(n*o.vpMaxHeight))&&(t=s),n=2+a.visualPattern.length*(o.deltaX+1),s=1+o.vpMaxHeight-(i+t),t=o.vpAlpha,o.vpAlpha=e,t=1<(t=4*Math.abs(o.vpAlpha-t))?.3:1.3-t,a.addKeyData([n,s,o.deltaX,i,t])))},this.onChange=function(t){t=o.targets[t.target.id];void 0!==t&&t.updatePosition()}}TypingVisualizer.prototype.removeTarget=function(t){if(void 0!==t){\"object\"!=typeof t&&(t=[t]);for(var e=0;e<t.length;e++){var i=\"string\"==typeof t[e]?document.getElementById(t[e]):t[e];i&&this.targets.hasOwnProperty(i.id)&&(this.targets[i.id].removeEventListener(\"input\",this.onChange),delete this.targets[i.id])}}},TypingVisualizer.prototype.addTarget=function(t){if(void 0!==t){\"object\"!=typeof t&&(t=[t]);for(var i=this,e=0;e<t.length;e++){var n,s,a,o,r,h,l=\"string\"==typeof t[e]?document.getElementById(t[e]):t[e];l&&(this.targets.hasOwnProperty(l.id)||(n=this.generateCanvas(l),(s=\"DIV\"!=(r=l.parentNode).tagName)?(a=document.createElement(\"DIV\"),this.setStyle(a,{position:\"relative\"})):a=r,n&&r&&(s?a.appendChild(n.container):a.insertBefore(n.container,l.nextSibling))&&(l.addEventListener(\"input\",i.onChange),s&&void 0!==l.style.width&&(this.setStyle(a,{position:\"relative\",width:l.style.width}),l.style.width=\"100%\"),o=l.scrollHeight>l.clientHeight?this.scrollOffset:0,this.setStyle(n.container,{position:\"absolute\",width:this.typingLength*(i.deltaX+2)+\"px\",height:\"100%\",right:(this.showTDNALogo?this.logoHeight+8+o:o+6)+\"px\",top:0,\"z-index\":3}),s&&(r.insertBefore(a,l),a.appendChild(l)),r=n.container.getBoundingClientRect(),n.canvas.width=r.width||this.typingLength*(i.deltaX+2),n.canvas.height=Math.min(r.height||this.vpMaxHeight,this.vpMaxHeight),this.setStyle(n.canvas,{\"margin-top\":\"6px\"}),this.setStyle(l,{\"padding-right\":n.canvas.width+6+(this.showTDNALogo?this.logoHeight+4:0)+\"px\"}),this.showTDNALogo&&(h=this.generateTDNALogo(),this.setStyle(h,{position:\"absolute\",right:o+6+\"px\",top:\"0\",\"margin-top\":\"6px\",\"line-height\":this.logoHeight+\"px\",\"z-index\":3}),a.appendChild(h),\"undefined\"!=typeof tippy&&tippy(h)),this.targets[l.id]={element:l,canvas:n.canvas,canvasContainer:n.container,canvasContext:n.canvas.getContext(\"2d\"),logo:h,visualPattern:[],scrollOffset:18,hasScroll:l.scrollHeight>l.clientHeight,hasVerticalScroll:function(){return this.element.scrollHeight>this.element.clientHeight},clearCanvas:function(){this.canvasContext&&this.canvasContext.clearRect(0,0,120,30)},addKeyData:function(t){this.visualPattern.push(t),this.update()},deleteKeyData:function(){this.visualPattern.pop(),this.update()},updatePosition:function(){var t=this.hasVerticalScroll();this.hasScroll!==t&&(this.hasScroll=t,this.logo.style.right=parseInt(this.logo.style.right)+(t?this.scrollOffset:-this.scrollOffset)+\"px\",this.canvasContainer.style.right=parseInt(this.canvasContainer.style.right)+(t?this.scrollOffset:-this.scrollOffset)+\"px\")},update:function(){this.updatePosition();for(var t=this.visualPattern.slice(-i.typingLength);t.length<i.typingLength;)t.unshift([0,0,0,0,0]);this.clearCanvas();for(var e=0;e<t.length;e++)this.canvasContext.fillStyle=\"rgba(256, 110, 0, \"+t[e][4]+\")\",this.canvasContext.fillRect(e*(i.deltaX+2),t[e][1],t[e][2],t[e][3])}})))}this.initListeners()}},TypingVisualizer.prototype.correctPosition=function(){for(var t in this.targets){var e=this.targets[t].element,i=this.targets[t].canvasContainer,n=this.targets[t].logo,s=e.getBoundingClientRect(),a=i&&i.getBoundingClientRect(),e=n&&n.getBoundingClientRect();n&&0<e.right-s.right&&(n.style.right=\"calc(\"+n.style.right+\" + \"+(e.right-s.right)+\"px + 6px)\"),n&&0<s.top-e.top&&(n.style.top=\"calc(\"+n.style.top+\" + \"+(s.top-e.top)+\"px + 6px)\"),i&&0<a.right-s.right&&(i.style.right=\"calc(\"+i.style.right+\" + \"+(a.right-s.right)+\"px + \"+this.logoHeight+\"px + 6px)\"),i&&0<s.top-a.top&&(i.style.top=\"calc(\"+i.style.top+\" + \"+(s.top-a.top)+\"px + 6px)\")}},TypingVisualizer.prototype.generateTDNALogo=function(){var t=document.createElement(\"A\");t.setAttribute(\"class\",\"tdna_logo\"),t.href=\"javascript: void(0)\",t.setAttribute(\"tabindex\",-1),t.setAttribute(\"data-toggle\",\"popover\"),t.setAttribute(\"data-trigger\",\"focus\"),t.setAttribute(\"data-content\",\"Protected by TypingDNA\"),t.setAttribute(\"title\",\"Protected by TypingDNA\"),t.setAttribute(\"data-placement\",\"left\");var e=document.createElement(\"IMG\");return this.setStyle(e,{height:this.logoHeight+\"px\",width:this.logoHeight+\"px\",\"vertical-align\":\"top\"}),e.src=\"https://www.typingdna.com/assets/images/external/icon-48.png\",e.alt=\"Protected by TypingDNA\",t.appendChild(e),t},TypingVisualizer.prototype.generateCanvas=function(t){if(void 0!==t){var e=document.createElement(\"DIV\");e.setAttribute(\"class\",\"tdna_canvas_container\");t=document.createElement(\"CANVAS\");return e.appendChild(t),{canvas:t,container:e}}},TypingVisualizer.prototype.init=function(){for(var t in this.targets)this.targets.hasOwnProperty(t)&&(this.targets[t].visualPattern=[]);this.initListeners()},TypingVisualizer.prototype.clearCanvas=function(t){if(void 0===t)this.targets.hasOwnProperty(t)&&this.targets[t].canvas.clearRect(0,0,120,30);else for(var e in this.targets)this.targets.hasOwnProperty(e)&&this.targets[e].canvas&&this.targets[e].canvas.clearRect(0,0,120,30)},TypingVisualizer.prototype.initListeners=function(){document.removeEventListener(\"keyup\",this.keyUp),document.removeEventListener(\"keydown\",this.keyDown),TypingVisualizer.isEmpty(this.targets)||(document.addEventListener(\"keyup\",this.keyUp),document.addEventListener(\"keydown\",this.keyDown))},TypingVisualizer.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0};";
}
