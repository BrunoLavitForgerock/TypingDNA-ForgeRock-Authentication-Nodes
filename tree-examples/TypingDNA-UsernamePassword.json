
{
  "origin": "7eaaf9acca4d14b852a80d23be76ee0f -",
  "innernodes": {
    "d3a05253-5a09-47e6-83a1-e7c306e5b517": {
      "_id": "d3a05253-5a09-47e6-83a1-e7c306e5b517",
      "_type": {
        "_id": "UsernameCollectorNode",
        "name": "Username Collector",
        "collection": true
      },
      "_outcomes": [
        {
          "id": "outcome",
          "displayName": "Outcome"
        }
      ]
    },
    "10b42396-4bb8-4b63-9d79-bb6b1edfa85a": {
      "_id": "10b42396-4bb8-4b63-9d79-bb6b1edfa85a",
      "_type": {
        "_id": "PasswordCollectorNode",
        "name": "Password Collector",
        "collection": true
      },
      "_outcomes": [
        {
          "id": "outcome",
          "displayName": "Outcome"
        }
      ]
    },
    "badea6bd-43f6-46a2-abd8-e09159b580b8": {
      "_id": "badea6bd-43f6-46a2-abd8-e09159b580b8",
      "showVisualizer": true,
      "targetIds": [
        "idToken1",
        "idToken2",
        "idToken3"
      ],
      "displayMessage": true,
      "disableCopyAndPaste": true,
      "script": "dcf58b60-2c30-4ce6-b5ca-9d34987ecec8",
      "submitButtonId": "loginButton_0",
      "_type": {
        "_id": "TypingDNARecorder",
        "name": "TypingDNA Recorder",
        "collection": true
      },
      "_outcomes": [
        {
          "id": "outcome",
          "displayName": "Outcome"
        }
      ]
    }
  },
  "nodes": {
    "1509e9a2-bd21-4d29-9e05-d2a33e673cd5": {
      "_id": "1509e9a2-bd21-4d29-9e05-d2a33e673cd5",
      "_type": {
        "_id": "DataStoreDecisionNode",
        "name": "Data Store Decision",
        "collection": true
      },
      "_outcomes": [
        {
          "id": "true",
          "displayName": "True"
        },
        {
          "id": "false",
          "displayName": "False"
        }
      ]
    },
    "39b25c55-376d-4ca6-91e5-ffce265f54fd": {
      "_id": "39b25c55-376d-4ca6-91e5-ffce265f54fd",
      "pageHeader": {},
      "pageDescription": {},
      "nodes": [
        {
          "_id": "d3a05253-5a09-47e6-83a1-e7c306e5b517",
          "nodeType": "UsernameCollectorNode",
          "displayName": "Username Collector"
        },
        {
          "_id": "10b42396-4bb8-4b63-9d79-bb6b1edfa85a",
          "nodeType": "PasswordCollectorNode",
          "displayName": "Password Collector"
        },
        {
          "_id": "badea6bd-43f6-46a2-abd8-e09159b580b8",
          "nodeType": "TypingDNARecorder",
          "displayName": "TypingDNA Recorder"
        }
      ],
      "_type": {
        "_id": "PageNode",
        "name": "Page Node",
        "collection": true
      },
      "_outcomes": [
        {
          "id": "outcome",
          "displayName": "Outcome"
        }
      ]
    },
    "8b858eb1-b906-4cbe-b694-e35476e46425": {
      "_id": "8b858eb1-b906-4cbe-b694-e35476e46425",
      "apiUrl": "https://api.typingdna.com",
      "usernameSalt": "random_string",
      "requestIdentifier": "ForgeRock",
      "retries": 1,
      "requestTimeout": 8000,
      "authAPIConfiguration": "Basic",
      "hashAlgorithm": "SHA256",
      "_type": {
        "_id": "TypingDNADecisionNode",
        "name": "TypingDNA Decision Node",
        "collection": true
      },
      "_outcomes": [
        {
          "id": "ENROLL",
          "displayName": "Enroll"
        },
        {
          "id": "INITIAL_ENROLLMENT_COMPLETE",
          "displayName": "Initial enrollment complete"
        },
        {
          "id": "RETRY",
          "displayName": "Retry"
        },
        {
          "id": "MATCH",
          "displayName": "Match"
        },
        {
          "id": "NO_MATCH",
          "displayName": "No match"
        },
        {
          "id": "FAIL",
          "displayName": "Fail"
        }
      ]
    }
  },
  "scripts": {
    "dcf58b60-2c30-4ce6-b5ca-9d34987ecec8": {
      "_id": "dcf58b60-2c30-4ce6-b5ca-9d34987ecec8",
      "name": "TypingDNA",
      "description": null,
      "script": "LyoqCiAqIFR5cGluZ0ROQSAtIFR5cGluZyBCaW9tZXRyaWNzIEphdmFTY3JpcHQgQVBJCiAqIGh0dHBzOi8vd3d3LnR5cGluZ2RuYS5jb20vc2NyaXB0cy90eXBpbmdkbmEuanMKICogaHR0cHM6Ly9hcGkudHlwaW5nZG5hLmNvbS9zY3JpcHRzL3R5cGluZ2RuYS5qcyAoYWx0ZXJuYXRpdmUpCiAqCiAqIEdpdEh1YiByZXBvc2l0b3J5CiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9UeXBpbmdETkEvVHlwaW5nRG5hUmVjb3JkZXItSmF2YVNjcmlwdAogKgogKiBAdmVyc2lvbiAzLjIKICogQGF1dGhvciBSYXVsIFBvcGEgJiBTdGVmYW4gRW5kcmVzCiAqIEBjb3B5cmlnaHQgVHlwaW5nRE5BIEluYy4gaHR0cHM6Ly93d3cudHlwaW5nZG5hLmNvbQogKiBAbGljZW5zZSBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKgogKiBUeXBpY2FsIHVzYWdlOgogKiB2YXIgdGRuYSA9IG5ldyBUeXBpbmdETkEoKTsgLy8gY3JlYXRlcyBhIG5ldyBUeXBpbmdETkEgb2JqZWN0IGFuZCBzdGFydHMgcmVjb3JkaW5nCiAqIHZhciB0eXBpbmdQYXR0ZXJuID0gdGRuYS5nZXRUeXBpbmdQYXR0ZXJuKHt0eXBlOjEsIHRleHQ6IkhlbGxvNWcyMT8qIn0pOwogKiByZXR1cm5zIGEgdHlwZSAxIHR5cGluZyBwYXR0ZXJuIChhbmQgY29udGludWVzIHJlY29yZGluZyBhZnRlcndhcmRzKQogKgogKiBPcHRpb25hbDoKICogdGRuYS5zdG9wKCk7IC8vIGVuZHMgcmVjb3JkaW5nIGFuZCBjbGVhcnMgaGlzdG9yeSBzdGFjayAocmV0dXJucyByZWNvcmRpbmcgZmxhZzogZmFsc2UpCiAqIHRkbmEuc3RhcnQoKTsgLy8gcmVzdGFydHMgdGhlIHJlY29yZGluZyBhZnRlciBhIHN0b3AgKHJldHVybnMgcmVjb3JkaW5nIGZsYWc6IHRydWUpCiAqIHRkbmEucmVzZXQoKTsgLy8gcmVzdGFydHMgdGhlIHJlY29yZGluZyBhbnl0aW1lLCBjbGVhcnMgaGlzdG9yeSBzdGFjayBhbmQgc3RhcnRzIGZyb20gc2NyYXRjaCAocmV0dXJucyBub3RoaW5nKQogKiB2YXIgdHlwaW5nUGF0dGVyblF1YWxpdHkgPSBUeXBpbmdETkEuZ2V0UXVhbGl0eSh0eXBpbmdQYXR0ZXJuKTsgLy9yZXR1cm5zIHRoZSBxdWFsaXR5L3N0cmVuZ3RoIG9mIGFueSB0eXBpbmcgcGF0dGVybgogKiAodGhlcmUgaXMgbm8gbmVlZCB0byBpbml0aWFsaXplIHRoZSBjbGFzcyB0byBkbyBwYXR0ZXJuIHF1YWxpdHkgY2hlY2tpbmcpCiAqLwoKLyoqCiAqIENyZWF0ZXMgYSBzaW5nbGUgaW5zdGFuY2UgKG9yIGEgcmVmZXJlbmNlKSBvZiB0aGUgVHlwaW5nRE5BIGNsYXNzCiAqIEByZXR1cm4ge09iamVjdH0gUmV0dXJucyB0aGUgc2luZ2xlIGluc3RhbmNlIG9mIHRoZSBUeXBpbmdETkEgY2xhc3MuCiAqIEBleGFtcGxlIHZhciB0ZG5hID0gbmV3IFR5cGluZ0ROQSgpOwogKi8KZnVuY3Rpb24gVHlwaW5nRE5BKCkgewogIGlmIChUeXBpbmdETkEuaW5pdGlhbGl6ZWQgIT09IHRydWUpIHsKCiAgICAvLyBNQUlOIEZVTkNUSU9OUyAvLwogICAgVHlwaW5nRE5BLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gVHlwaW5nRE5BLnN0YXJ0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9CiAgICBUeXBpbmdETkEucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIFR5cGluZ0ROQS5zdG9wLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9CiAgICBUeXBpbmdETkEucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBUeXBpbmdETkEucmVzZXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KICAgIFR5cGluZ0ROQS5wcm90b3R5cGUucmVtb3ZlRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIFR5cGluZ0ROQS5yZW1vdmVFdmVudExpc3RlbmVycy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQogICAgVHlwaW5nRE5BLnByb3RvdHlwZS5hZGRUYXJnZXQgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIFR5cGluZ0ROQS5hZGRUYXJnZXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KICAgIFR5cGluZ0ROQS5wcm90b3R5cGUucmVtb3ZlVGFyZ2V0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBUeXBpbmdETkEucmVtb3ZlVGFyZ2V0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9CiAgICBUeXBpbmdETkEucHJvdG90eXBlLmdldFR5cGluZ1BhdHRlcm4gPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIFR5cGluZ0ROQS5nZXRUeXBpbmdQYXR0ZXJuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9CiAgICBUeXBpbmdETkEucHJvdG90eXBlLmdldE1vdXNlRGlhZ3JhbSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gVHlwaW5nRE5BLmdldE1vdXNlRGlhZ3JhbS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQogICAgVHlwaW5nRE5BLnByb3RvdHlwZS5zdGFydE1vdXNlID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBUeXBpbmdETkEuc3RhcnRNb3VzZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQogICAgVHlwaW5nRE5BLnByb3RvdHlwZS5zdG9wTW91c2UgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIFR5cGluZ0ROQS5zdG9wTW91c2UuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KICAgIFR5cGluZ0ROQS5wcm90b3R5cGUuZ2V0UXVhbGl0eSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gVHlwaW5nRE5BLmdldFF1YWxpdHkuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KICAgIFR5cGluZ0ROQS5wcm90b3R5cGUuZ2V0TGVuZ3RoID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBUeXBpbmdETkEuZ2V0TGVuZ3RoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9CiAgICBUeXBpbmdETkEucHJvdG90eXBlLmlzTW9iaWxlID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBUeXBpbmdETkEuaXNNb2JpbGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KICAgIFR5cGluZ0ROQS5wcm90b3R5cGUuZ2V0VGV4dElkID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBUeXBpbmdETkEuZ2V0VGV4dElkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgIH0KICAgIFR5cGluZ0ROQS5wcm90b3R5cGUuY2hlY2tFbnZpcm9ubWVudCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gVHlwaW5nRE5BLmNoZWNrRW52aXJvbm1lbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KCiAgICAvLyBERVBSRUNBVEVEIEZVTkNUSU9OUyAvLwogICAgVHlwaW5nRE5BLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbigpIHsKICAgICAgLy8gZGVwcmVjYXRlZCBpbiBmYXZvciBvZiBnZXRUeXBpZ25QYXR0ZXJuKCkKICAgICAgcmV0dXJuIFR5cGluZ0ROQS5nZXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KICAgIFR5cGluZ0ROQS5wcm90b3R5cGUuc3RhcnREaWFncmFtID0gZnVuY3Rpb24oKSB7CiAgICAgIC8vIGRlcHJlY2F0ZWQgaW4gZmF2b3Igb2Ygc3RhcnQoKQogICAgICAvLyByZXR1cm4gVHlwaW5nRE5BLnN0YXJ0RGlhZ3JhbS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQogICAgVHlwaW5nRE5BLnByb3RvdHlwZS5zdG9wRGlhZ3JhbSA9IGZ1bmN0aW9uKCkgewogICAgICAvLyBkZXByZWNhdGVkIGluIGZhdm9yIG9mIHN0b3AoKQogICAgICAvLyByZXR1cm4gVHlwaW5nRE5BLnN0b3BEaWFncmFtLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9CiAgICBUeXBpbmdETkEucHJvdG90eXBlLmdldERpYWdyYW0gPSBmdW5jdGlvbigpIHsKICAgICAgLy8gZGVwcmVjYXRlZCBpbiBmYXZvciBvZiBnZXRUeXBpZ25QYXR0ZXJuKCkKICAgICAgcmV0dXJuIFR5cGluZ0ROQS5nZXREaWFncmFtLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9CiAgICBUeXBpbmdETkEucHJvdG90eXBlLmdldEV4dGVuZGVkRGlhZ3JhbSA9IGZ1bmN0aW9uKCkgewogICAgICAvLyBkZXByZWNhdGVkIGluIGZhdm9yIG9mIGdldFR5cGlnblBhdHRlcm4oKQogICAgICByZXR1cm4gVHlwaW5nRE5BLmdldEV4dGVuZGVkRGlhZ3JhbS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQoKICAgIFR5cGluZ0ROQS5pbml0aWFsaXplZCA9IHRydWU7CiAgICBUeXBpbmdETkEucHJvdG90eXBlLm1heEhpc3RvcnlMZW5ndGggPSBUeXBpbmdETkEubWF4SGlzdG9yeUxlbmd0aDsKICAgIFR5cGluZ0ROQS5wcm90b3R5cGUuZGVmYXVsdEhpc3RvcnlMZW5ndGggPSBUeXBpbmdETkEuZGVmYXVsdEhpc3RvcnlMZW5ndGg7CiAgICBUeXBpbmdETkEucHJvdG90eXBlLm1heFNlZWtUaW1lID0gVHlwaW5nRE5BLm1heFNlZWtUaW1lOwogICAgVHlwaW5nRE5BLnByb3RvdHlwZS5tYXhQcmVzc1RpbWUgPSBUeXBpbmdETkEubWF4UHJlc3NUaW1lOwogICAgVHlwaW5nRE5BLnZlcnNpb24gPSAzLjI7CiAgICBUeXBpbmdETkEuY29va2llSWQgPSAwOwogICAgVHlwaW5nRE5BLmZsYWdzID0gMDsKICAgIFR5cGluZ0ROQS5pbnN0YW5jZSA9IHRoaXM7CiAgICBUeXBpbmdETkEuZG9jdW1lbnQgPSBkb2N1bWVudDsKICAgIFR5cGluZ0ROQS51YSA9IHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LAogICAgICAgIFR5cGluZ0ROQS5wbGF0Zm9ybSA9IHdpbmRvdy5uYXZpZ2F0b3IucGxhdGZvcm07CiAgICBUeXBpbmdETkEubWF4SGlzdG9yeUxlbmd0aCA9IDIwMDA7CiAgICBUeXBpbmdETkEubWF4U2Vla1RpbWUgPSAxNTAwOwogICAgVHlwaW5nRE5BLm1heFByZXNzVGltZSA9IDMwMDsKICAgIFR5cGluZ0ROQS5kZWZhdWx0SGlzdG9yeUxlbmd0aCA9IDE2MDsKICAgIFR5cGluZ0ROQS5zcEtleUNvZGVzID0gWzgsIDEzLCAzMl07CiAgICBUeXBpbmdETkEuc3BLZXlDb2Rlc09iaiA9IHsKICAgICAgODogMSwKICAgICAgMTM6IDEsCiAgICAgIDMyOiAxLAogICAgfTsKICAgIFR5cGluZ0ROQS5rZXlDb2RlcyA9IFs2NSwgNjYsIDY3LCA2OCwgNjksIDcwLCA3MSwgNzIsIDczLCA3NCwgNzUsIDc2LCA3NywgNzgsIDc5LCA4MCwgODEsIDgyLCA4MywgODQsIDg1LCA4NiwgODcsIDg4LCA4OSwgOTAsCiAgICAgIDMyLCAyMjIsIDE4OCwgMTkwLCAxODYsIDE4NywgMTg5LCAxOTEsIDQ4LCA0OSwgNTAsIDUxLCA1MiwgNTMsIDU0LCA1NSwgNTYsIDU3CiAgICBdOwogICAgVHlwaW5nRE5BLmtleUNvZGVzT2JqID0ge30KICAgIHZhciBrZXlDb2Rlc0xlbiA9IFR5cGluZ0ROQS5rZXlDb2Rlcy5sZW5ndGg7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleUNvZGVzTGVuOyBpKyspIHsKICAgICAgVHlwaW5nRE5BLmtleUNvZGVzT2JqW1R5cGluZ0ROQS5rZXlDb2Rlc1tpXV0gPSAxOwogICAgfQogICAgVHlwaW5nRE5BLnB0MSA9IFR5cGluZ0ROQS51dDEgPSAobmV3IERhdGUpLmdldFRpbWUoKTsKICAgIFR5cGluZ0ROQS53ZmsgPSBbXTsKICAgIFR5cGluZ0ROQS5zdGkgPSBbXTsKICAgIFR5cGluZ0ROQS5za3QgPSBbXTsKICAgIFR5cGluZ0ROQS5yZWNvcmRpbmcgPSB0cnVlOwogICAgVHlwaW5nRE5BLm1vdXNlUmVjb3JkaW5nID0gdHJ1ZTsKICAgIFR5cGluZ0ROQS5tb3VzZU1vdmVSZWNvcmRpbmcgPSBmYWxzZTsKICAgIFR5cGluZ0ROQS5zcEtleVJlY29yZGluZyA9IHRydWU7CiAgICBUeXBpbmdETkEuZGlhZ3JhbVJlY29yZGluZyA9IHRydWU7CiAgICBUeXBpbmdETkEubW90aW9uRml4ZWREYXRhID0gdHJ1ZTsKICAgIFR5cGluZ0ROQS5tb3Rpb25BcnJheURhdGEgPSB0cnVlOwogICAgVHlwaW5nRE5BLmR3ZmsgPSBbXTsKICAgIFR5cGluZ0ROQS5kc3RpID0gW107CiAgICBUeXBpbmdETkEuZHNrdCA9IFtdOwogICAgVHlwaW5nRE5BLmRya2MgPSBbXTsKICAgIFR5cGluZ0ROQS5kbGFzdERvd25LZXk7CiAgICBUeXBpbmdETkEucHJldktleUNvZGUgPSAwOwogICAgVHlwaW5nRE5BLm1heE1vdmVEZWx0YVRpbWUgPSA2MDA7CiAgICBUeXBpbmdETkEubWF4U2Nyb2xsRGVsdGFUaW1lID0gODAwOwogICAgVHlwaW5nRE5BLm1heFN0b3BUaW1lID0gMTUwMDsKICAgIFR5cGluZ0ROQS5tYXhDbGlja1RpbWUgPSA2MDA7CiAgICBUeXBpbmdETkEubWF4TW91c2VIaXN0b3J5TGVuZ3RoID0gNTAwOwogICAgVHlwaW5nRE5BLmxhc3RNb3VzZU1vdmVUaW1lID0gVHlwaW5nRE5BLmxhc3RNb3VzZURvd25UaW1lID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7CiAgICBUeXBpbmdETkEuc3RvcFRpbWVzID0gW107CiAgICBUeXBpbmdETkEuY2xpY2tUaW1lcyA9IFtdOwogICAgVHlwaW5nRE5BLmxhc3RNb3VzZVN0b3AgPSBmYWxzZTsKICAgIFR5cGluZ0ROQS56bCA9IDAuMDAwMDAwMTsKICAgIFR5cGluZ0ROQS5BQ0lucHV0TGVuZ3RocyA9IHsKICAgICAgaW5wdXRzOiBbXSwKICAgICAgbGFzdExlbmd0aDogW10sCiAgICB9OwogICAgVHlwaW5nRE5BLnRhcmdldElkcyA9IFtdOwogICAgVHlwaW5nRE5BLmxhc3RUYXJnZXQgPSAiIjsKICAgIFR5cGluZ0ROQS5sYXN0VGFyZ2V0Rm91bmQgPSBmYWxzZTsKICAgIFR5cGluZ0ROQS5yZXBsYWNlTWlzc2luZ0tleXMgPSB0cnVlOwogICAgVHlwaW5nRE5BLnJlcGxhY2VNaXNzaW5nS2V5c1BlcmMgPSA3OwogICAgVHlwaW5nRE5BLnByZXNzQ2FsY3VsYXRlZCA9IGZhbHNlOwogICAgVHlwaW5nRE5BLnByZXNzUmVjb3JkZWQgPSBmYWxzZTsKCiAgICBUeXBpbmdETkEuY2hlY2tFbnZpcm9ubWVudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGVudiA9IHsKICAgICAgICBicm93c2VyVHlwZTogJycsCiAgICAgICAgaXNNb2JpbGU6IHRoaXMuaXNNb2JpbGUoKSA9PT0gMSwKICAgICAgICBoYXNNb3Rpb25TZW5zb3JzOiBmYWxzZSwKICAgICAgICBuZWVkc1Blcm1pc3Npb25Gb3JNb3Rpb25TZW5zb3JzOiBmYWxzZSwKICAgICAgfTsKCiAgICAgIC8vIEJsaW5rCiAgICAgIGlmICgoISF3aW5kb3cuY2hyb21lICYmICghIXdpbmRvdy5jaHJvbWUud2Vic3RvcmUgfHwgISF3aW5kb3cuY2hyb21lLnJ1bnRpbWUgfHwgISF3aW5kb3cuY2hyb21lLmxvYWRUaW1lcykKICAgICAgICAgIHx8ICghIXdpbmRvdy5vcHIgJiYgISFvcHIuYWRkb25zKSB8fCAhIXdpbmRvdy5vcGVyYSB8fCBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJyBPUFIvJykgPj0gMCkKICAgICAgICAgICYmICEhd2luZG93LkNTUykgewogICAgICAgIGVudi5icm93c2VyVHlwZSA9ICdibGluayc7CiAgICAgIH0KICAgICAgLy8gT3BlcmEKICAgICAgZWxzZSBpZiAoKCEhd2luZG93Lm9wciAmJiAhIXdpbmRvdy5vcHIuYWRkb25zKSB8fCAhIXdpbmRvdy5vcGVyYSB8fCBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJyBPUFIvJykgPj0gMCkgewogICAgICAgIGVudi5icm93c2VyVHlwZSA9ICdvcGVyYSc7CiAgICAgIH0KICAgICAgLy8gRmlyZWZveAogICAgICBlbHNlIGlmICh0eXBlb2YgSW5zdGFsbFRyaWdnZXIgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgZW52LmJyb3dzZXJUeXBlID0gJ2ZpcmVmb3gnOwogICAgICB9CiAgICAgIC8vIEludGVybmV0IEV4cGxvcmVyCiAgICAgIGVsc2UgaWYgKC8qQGNjX29uIUAqL2ZhbHNlIHx8ICEhZG9jdW1lbnQuZG9jdW1lbnRNb2RlKSB7CiAgICAgICAgZW52LmJyb3dzZXJUeXBlID0gJ2ludGVybmV0IGV4cGxvcmVyJzsKICAgICAgfQogICAgICAvLyBFZGdlCiAgICAgIGVsc2UgaWYgKCEoLypAY2Nfb24hQCovZmFsc2UgfHwgISFkb2N1bWVudC5kb2N1bWVudE1vZGUpICYmICEhd2luZG93LlN0eWxlTWVkaWEpIHsKICAgICAgICBlbnYuYnJvd3NlclR5cGUgPSAnZWRnZSc7CiAgICAgIH0KICAgICAgLy8gRWRnZSBDaHJvbWl1bQogICAgICBlbHNlIGlmICghIXdpbmRvdy5jaHJvbWUgJiYgKCEhd2luZG93LmNocm9tZS53ZWJzdG9yZSB8fCAhIXdpbmRvdy5jaHJvbWUucnVudGltZSB8fCAhIXdpbmRvdy5jaHJvbWUubG9hZFRpbWVzKSAmJiAobmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJFZGciKSAhPSAtMSkpIHsKICAgICAgICBlbnYuYnJvd3NlclR5cGUgPSAnZWRnZSBjaHJvbWl1bSc7CiAgICAgIH0KICAgICAgLy8gQ2hyb21lCiAgICAgIGVsc2UgaWYgKCEhd2luZG93LmNocm9tZSAmJiAoISF3aW5kb3cuY2hyb21lLndlYnN0b3JlIHx8ICEhd2luZG93LmNocm9tZS5ydW50aW1lIHx8ICEhd2luZG93LmNocm9tZS5sb2FkVGltZXMpKSB7CiAgICAgICAgZW52LmJyb3dzZXJUeXBlID0gJ2Nocm9tZSc7CiAgICAgIH0KICAgICAgLy8gU2FmYXJpCiAgICAgIGVsc2UgaWYgKC9jb25zdHJ1Y3Rvci9pLnRlc3Qod2luZG93LkhUTUxFbGVtZW50KQogICAgICAgICAgfHwgKGZ1bmN0aW9uIChwKSB7IHJldHVybiBwLnRvU3RyaW5nKCkgPT09ICJbb2JqZWN0IFNhZmFyaVJlbW90ZU5vdGlmaWNhdGlvbl0iOyB9KSghd2luZG93WydzYWZhcmknXSB8fCAodHlwZW9mIHNhZmFyaSAhPT0gJ3VuZGVmaW5lZCcgJiYgc2FmYXJpLnB1c2hOb3RpZmljYXRpb24pKQogICAgICAgICAgfHwgKG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIikgPiAtMSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0Nocm9tZScpID09PSAtMSkpIHsKICAgICAgICBlbnYuYnJvd3NlclR5cGUgPSAnc2FmYXJpJzsKICAgICAgfQoKICAgICAgaWYgKGVudi5pc01vYmlsZSkgewogICAgICAgIGVudi5oYXNNb3Rpb25TZW5zb3JzID0gd2luZG93LkRldmljZU1vdGlvbkV2ZW50ICE9PSB1bmRlZmluZWQ7CiAgICAgICAgZW52Lm5lZWRzUGVybWlzc2lvbkZvck1vdGlvblNlbnNvcnMgPSB3aW5kb3cuRGV2aWNlTW90aW9uRXZlbnQgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygd2luZG93LkRldmljZU1vdGlvbkV2ZW50LnJlcXVlc3RQZXJtaXNzaW9uID09PSAnZnVuY3Rpb24nOwogICAgICB9CgogICAgICByZXR1cm4gZW52OwogICAgfTsKCiAgICBUeXBpbmdETkEua2V5RG93biA9IGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKCFUeXBpbmdETkEucmVjb3JkaW5nICYmICFUeXBpbmdETkEuZGlhZ3JhbVJlY29yZGluZykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoIVR5cGluZ0ROQS5pc1RhcmdldChlLnRhcmdldC5pZCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIGtleUNvZGUgPSBlLmtleUNvZGU7CiAgICAgIGlmIChUeXBpbmdETkEud2ZrW2tleUNvZGVdID09PSAxIHx8IFR5cGluZ0ROQS5kd2ZrW2tleUNvZGVdID09PSAxKSB7CiAgICAgICAgLy9yZXR1cm47CiAgICAgIH0KICAgICAgdmFyIHQwID0gVHlwaW5nRE5BLnB0MTsKICAgICAgVHlwaW5nRE5BLnB0MSA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpOwogICAgICB2YXIgc2Vla1RvdGFsID0gVHlwaW5nRE5BLnB0MSAtIHQwOwogICAgICB2YXIgc3RhcnRUaW1lID0gVHlwaW5nRE5BLnB0MTsKICAgICAgaWYgKFR5cGluZ0ROQS5yZWNvcmRpbmcgPT09IHRydWUgfHwgKFR5cGluZ0ROQS5zcEtleUNvZGVzT2JqW2tleUNvZGVdICYmIFR5cGluZ0ROQS5zcEtleVJlY29yZGluZyA9PT0gdHJ1ZSkpIHsKICAgICAgICBpZiAoIWUuc2hpZnRLZXkpIHsKICAgICAgICAgIFR5cGluZ0ROQS53Zmtba2V5Q29kZV0gPSAxOwogICAgICAgICAgVHlwaW5nRE5BLnNrdFtrZXlDb2RlXSA9IHNlZWtUb3RhbDsKICAgICAgICAgIFR5cGluZ0ROQS5zdGlba2V5Q29kZV0gPSBzdGFydFRpbWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChUeXBpbmdETkEuZGlhZ3JhbVJlY29yZGluZyA9PT0gdHJ1ZSkgewogICAgICAgIFR5cGluZ0ROQS5kd2ZrW2tleUNvZGVdID0gMTsKICAgICAgICBUeXBpbmdETkEuZHNrdFtrZXlDb2RlXSA9IHNlZWtUb3RhbDsKICAgICAgICBUeXBpbmdETkEuZHN0aVtrZXlDb2RlXSA9IHN0YXJ0VGltZTsKICAgICAgICBUeXBpbmdETkEuZGxhc3REb3duS2V5ID0ga2V5Q29kZTsKICAgICAgfQogICAgfQoKICAgIFR5cGluZ0ROQS5rZXlQcmVzcyA9IGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKCFUeXBpbmdETkEucmVjb3JkaW5nICYmICFUeXBpbmdETkEuZGlhZ3JhbVJlY29yZGluZykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoIVR5cGluZ0ROQS5pc1RhcmdldChlLnRhcmdldC5pZCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKFR5cGluZ0ROQS5kaWFncmFtUmVjb3JkaW5nID09PSB0cnVlKSB7CiAgICAgICAgdmFyIGtleUNvZGUgPSBUeXBpbmdETkEuZGxhc3REb3duS2V5OwogICAgICAgIFR5cGluZ0ROQS5kcmtjW2tleUNvZGVdID0gZS5jaGFyQ29kZTsKICAgICAgfQogICAgfQoKICAgIFR5cGluZ0ROQS5rZXlVcCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKCFUeXBpbmdETkEucmVjb3JkaW5nICYmICFUeXBpbmdETkEuZGlhZ3JhbVJlY29yZGluZykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoIVR5cGluZ0ROQS5pc1RhcmdldChlLnRhcmdldC5pZCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIHV0ID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7CiAgICAgIHZhciBrZXlDb2RlID0gZS5rZXlDb2RlOwogICAgICB2YXIgcHJlc3NUaW1lID0gMDsKICAgICAgdmFyIHNlZWtUaW1lID0gMDsKICAgICAgaWYgKFR5cGluZ0ROQS5yZWNvcmRpbmcgPT09IHRydWUgfHwgKFR5cGluZ0ROQS5zcEtleUNvZGVzT2JqW2tleUNvZGVdICYmIFR5cGluZ0ROQS5zcEtleVJlY29yZGluZyA9PT0gdHJ1ZSkpIHsKICAgICAgICBpZiAoIWUuc2hpZnRLZXkpIHsKICAgICAgICAgIGlmIChUeXBpbmdETkEud2ZrW2tleUNvZGVdID09PSAxKSB7CiAgICAgICAgICAgIHByZXNzVGltZSA9IHV0IC0gVHlwaW5nRE5BLnN0aVtrZXlDb2RlXTsKICAgICAgICAgICAgc2Vla1RpbWUgPSBUeXBpbmdETkEuc2t0W2tleUNvZGVdOwogICAgICAgICAgICB2YXIgYXJyID0gW2tleUNvZGUsIHNlZWtUaW1lLCBwcmVzc1RpbWUsIFR5cGluZ0ROQS5wcmV2S2V5Q29kZSwgdXQsIGUudGFyZ2V0LmlkLF07CiAgICAgICAgICAgIFR5cGluZ0ROQS5oaXN0b3J5LmFkZChhcnIpOwogICAgICAgICAgICBUeXBpbmdETkEucHJldktleUNvZGUgPSBrZXlDb2RlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBUeXBpbmdETkEud2ZrW2tleUNvZGVdID0gMDsKICAgICAgfQogICAgICBpZiAoVHlwaW5nRE5BLmRpYWdyYW1SZWNvcmRpbmcgPT09IHRydWUpIHsKICAgICAgICBpZiAoVHlwaW5nRE5BLmRya2Nba2V5Q29kZV0gIT09IHVuZGVmaW5lZCAmJiBUeXBpbmdETkEuZHJrY1trZXlDb2RlXSAhPT0gMCkgewogICAgICAgICAgaWYgKFR5cGluZ0ROQS5kd2ZrW2tleUNvZGVdID09PSAxKSB7CiAgICAgICAgICAgIHByZXNzVGltZSA9IHV0IC0gVHlwaW5nRE5BLmRzdGlba2V5Q29kZV07CiAgICAgICAgICAgIHNlZWtUaW1lID0gVHlwaW5nRE5BLmRza3Rba2V5Q29kZV07CiAgICAgICAgICAgIHZhciByZWFsS2V5Q29kZSA9IFR5cGluZ0ROQS5kcmtjW2tleUNvZGVdOwogICAgICAgICAgICB2YXIgYXJyRCA9IFtrZXlDb2RlLCBzZWVrVGltZSwgcHJlc3NUaW1lLCByZWFsS2V5Q29kZSwgdXQsIGUudGFyZ2V0LmlkLF07CiAgICAgICAgICAgIFR5cGluZ0ROQS5oaXN0b3J5LmFkZERpYWdyYW0oYXJyRCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFR5cGluZ0ROQS5kd2ZrW2tleUNvZGVdID0gMDsKICAgICAgfQogICAgfQoKICAgIFR5cGluZ0ROQS5Nb2JpbGVLZXlEb3duID0gZnVuY3Rpb24oZSkgewogICAgICBpZiAoIVR5cGluZ0ROQS5yZWNvcmRpbmcgJiYgIVR5cGluZ0ROQS5kaWFncmFtUmVjb3JkaW5nKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICghVHlwaW5nRE5BLmlzVGFyZ2V0KGUudGFyZ2V0LmlkKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YXIga2V5Q29kZSA9IGUua2V5Q29kZTsKICAgICAgaWYgKFR5cGluZ0ROQS53Zmtba2V5Q29kZV0gPT09IDEgfHwgVHlwaW5nRE5BLmR3Zmtba2V5Q29kZV0gPT09IDEpIHsKICAgICAgICAvL3JldHVybjsKICAgICAgfQogICAgICBUeXBpbmdETkEubGFzdFByZXNzVGltZSA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpOwogICAgICBpZiAoVHlwaW5nRE5BLnJlY29yZGluZyA9PT0gdHJ1ZSB8fCAoVHlwaW5nRE5BLnNwS2V5Q29kZXNPYmpba2V5Q29kZV0gJiYgVHlwaW5nRE5BLnNwS2V5UmVjb3JkaW5nID09PSB0cnVlKSkgewogICAgICAgIFR5cGluZ0ROQS53Zmtba2V5Q29kZV0gPSAxOwogICAgICB9CiAgICAgIGlmIChUeXBpbmdETkEuZGlhZ3JhbVJlY29yZGluZyA9PT0gdHJ1ZSkgewogICAgICAgIFR5cGluZ0ROQS5kd2ZrW2tleUNvZGVdID0gMTsKICAgICAgICBUeXBpbmdETkEuZGxhc3REb3duS2V5ID0ga2V5Q29kZTsKICAgICAgfQogICAgfQoKICAgIFR5cGluZ0ROQS5Nb2JpbGVLZXlQcmVzcyA9IGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKCFUeXBpbmdETkEucmVjb3JkaW5nICYmICFUeXBpbmdETkEuZGlhZ3JhbVJlY29yZGluZykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoIVR5cGluZ0ROQS5pc1RhcmdldChlLnRhcmdldC5pZCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKFR5cGluZ0ROQS5kaWFncmFtUmVjb3JkaW5nID09PSB0cnVlKSB7CiAgICAgICAgdmFyIGtleUNvZGUgPSBUeXBpbmdETkEuZGxhc3REb3duS2V5OwogICAgICAgIFR5cGluZ0ROQS5kcmtjW2tleUNvZGVdID0gZS5jaGFyQ29kZTsKICAgICAgfQogICAgfQoKICAgIFR5cGluZ0ROQS5Nb2JpbGVLZXlVcCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKCFUeXBpbmdETkEucmVjb3JkaW5nICYmICFUeXBpbmdETkEuZGlhZ3JhbVJlY29yZGluZykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoIVR5cGluZ0ROQS5pc1RhcmdldChlLnRhcmdldC5pZCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIHQwID0gVHlwaW5nRE5BLnV0MTsKICAgICAgVHlwaW5nRE5BLnV0MSA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpOwogICAgICB2YXIgc2Vla1RpbWUgPSBUeXBpbmdETkEudXQxIC0gdDA7CiAgICAgIHZhciBrcEdldCA9IFR5cGluZ0ROQS5rcEdldEFsbCgpOwogICAgICB2YXIgcHJlc3NUaW1lID0gKGtwR2V0WzBdICE9PSAwKSA/IE1hdGgucm91bmQoVHlwaW5nRE5BLnV0MSAtIGtwR2V0WzBdKSA6IDA7CiAgICAgIGlmIChpc05hTihwcmVzc1RpbWUpKSB7CiAgICAgICAgcHJlc3NUaW1lID0gMDsKICAgICAgfQogICAgICB2YXIga2V5Q29kZSA9IGUua2V5Q29kZTsKICAgICAgaWYgKFR5cGluZ0ROQS5yZWNvcmRpbmcgPT09IHRydWUgfHwgKFR5cGluZ0ROQS5zcEtleUNvZGVzT2JqW2tleUNvZGVdICYmIFR5cGluZ0ROQS5zcEtleVJlY29yZGluZyA9PT0gdHJ1ZSkpIHsKICAgICAgICBpZiAoVHlwaW5nRE5BLndma1trZXlDb2RlXSA9PT0gMSkgewogICAgICAgICAgdmFyIGFyciA9IFtrZXlDb2RlLCBzZWVrVGltZSwgcHJlc3NUaW1lLCBUeXBpbmdETkEucHJldktleUNvZGUsIFR5cGluZ0ROQS51dDEsIGUudGFyZ2V0LmlkXTsKICAgICAgICAgIFR5cGluZ0ROQS5oaXN0b3J5LmFkZChhcnIpOwogICAgICAgICAgVHlwaW5nRE5BLnByZXZLZXlDb2RlID0ga2V5Q29kZTsKICAgICAgICB9CiAgICAgICAgVHlwaW5nRE5BLndma1trZXlDb2RlXSA9IDA7CiAgICAgIH0KICAgICAgaWYgKFR5cGluZ0ROQS5kaWFncmFtUmVjb3JkaW5nID09PSB0cnVlKSB7CiAgICAgICAgaWYgKFR5cGluZ0ROQS5kcmtjW2tleUNvZGVdICE9PSB1bmRlZmluZWQgJiYgVHlwaW5nRE5BLmRya2Nba2V5Q29kZV0gIT09IDApIHsKICAgICAgICAgIGlmIChUeXBpbmdETkEuZHdma1trZXlDb2RlXSA9PT0gMSkgewogICAgICAgICAgICB2YXIgcmVhbEtleUNvZGUgPSBUeXBpbmdETkEuZHJrY1trZXlDb2RlXTsKICAgICAgICAgICAgdmFyIGFyckQgPSBba2V5Q29kZSwgc2Vla1RpbWUsIHByZXNzVGltZSwgcmVhbEtleUNvZGUsIFR5cGluZ0ROQS51dDEsIGUudGFyZ2V0LmlkLCBrcEdldFsxXS5qb2luKCcsJyksIGtwR2V0WzJdLmpvaW4oJywnKSwga3BHZXRbM10uam9pbignLCcpLCBrcEdldFs0XS5qb2luKCcsJyldOwogICAgICAgICAgICBUeXBpbmdETkEuaGlzdG9yeS5hZGREaWFncmFtKGFyckQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBUeXBpbmdETkEuZHdma1trZXlDb2RlXSA9IDA7CiAgICAgIH0KICAgIH0KCiAgICAvLyBvbmx5IGZvciBBbmRyb2lkIGRldmljZXMKICAgIFR5cGluZ0ROQS5BbmRyb2lkS2V5RG93biA9IGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKCFUeXBpbmdETkEucmVjb3JkaW5nICYmICFUeXBpbmdETkEuZGlhZ3JhbVJlY29yZGluZykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoIVR5cGluZ0ROQS5pc1RhcmdldChlLnRhcmdldC5pZCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgVHlwaW5nRE5BLmxhc3RQcmVzc1RpbWUgPSAobmV3IERhdGUpLmdldFRpbWUoKTsKICAgICAgaWYgKFR5cGluZ0ROQS5BQ0lucHV0TGVuZ3Rocy5pbnB1dHMuaW5kZXhPZihlLnRhcmdldCkgPT09IC0xKSB7CiAgICAgICAgVHlwaW5nRE5BLkFDSW5wdXRMZW5ndGhzLmlucHV0cy5wdXNoKGUudGFyZ2V0KTsKICAgICAgICBUeXBpbmdETkEuQUNJbnB1dExlbmd0aHMubGFzdExlbmd0aC5wdXNoKDApOwogICAgICB9CiAgICB9CgogICAgVHlwaW5nRE5BLkFuZHJvaWRLZXlVcCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKCFUeXBpbmdETkEucmVjb3JkaW5nICYmICFUeXBpbmdETkEuZGlhZ3JhbVJlY29yZGluZykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YXIgdDAgPSBUeXBpbmdETkEudXQxOwogICAgICBUeXBpbmdETkEudXQxID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7CiAgICAgIGlmICghVHlwaW5nRE5BLmlzVGFyZ2V0KGUudGFyZ2V0LmlkKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YXIgc2Vla1RpbWUgPSBUeXBpbmdETkEudXQxIC0gdDA7CiAgICAgIHZhciBrcEdldCA9IFR5cGluZ0ROQS5rcEdldEFsbCgpOwogICAgICB2YXIgcHJlc3NUaW1lID0gKGtwR2V0WzBdICE9PSAwKSA/IE1hdGgucm91bmQoVHlwaW5nRE5BLnV0MSAtIGtwR2V0WzBdKSA6IDA7CiAgICAgIGlmIChpc05hTihwcmVzc1RpbWUpKSB7CiAgICAgICAgcHJlc3NUaW1lID0gMDsKICAgICAgfQogICAgICB2YXIga2V5Q29kZSA9IGUua2V5Q29kZTsKICAgICAgdmFyIHRhcmdldEluZGV4ID0gVHlwaW5nRE5BLkFDSW5wdXRMZW5ndGhzLmlucHV0cy5pbmRleE9mKGUudGFyZ2V0KTsKICAgICAgaWYgKHRhcmdldEluZGV4ID09PSAtMSkgewogICAgICAgIFR5cGluZ0ROQS5BQ0lucHV0TGVuZ3Rocy5pbnB1dHMucHVzaChlLnRhcmdldCk7CiAgICAgICAgVHlwaW5nRE5BLkFDSW5wdXRMZW5ndGhzLmxhc3RMZW5ndGgucHVzaCgwKTsKICAgICAgICB0YXJnZXRJbmRleCA9IFR5cGluZ0ROQS5BQ0lucHV0TGVuZ3Rocy5pbnB1dHMuaW5kZXhPZihlLnRhcmdldCk7CiAgICAgIH0KICAgICAgdmFyIGNoYXJDb2RlID0gMDsKICAgICAgaWYgKGUudGFyZ2V0LnZhbHVlLmxlbmd0aCA+PSBUeXBpbmdETkEuQUNJbnB1dExlbmd0aHMubGFzdExlbmd0aFt0YXJnZXRJbmRleF0pIHsKICAgICAgICB2YXIgY2hhciA9IGUudGFyZ2V0LnZhbHVlLnN1YnN0cigoZS50YXJnZXQuc2VsZWN0aW9uU3RhcnQgLSAxKSB8fCAwLCAxKTsKICAgICAgICBrZXlDb2RlID0gY2hhci50b1VwcGVyQ2FzZSgpLmNoYXJDb2RlQXQoMCk7CiAgICAgICAgY2hhckNvZGUgPSBjaGFyLmNoYXJDb2RlQXQoMCk7CiAgICAgIH0KICAgICAgVHlwaW5nRE5BLkFDSW5wdXRMZW5ndGhzLmxhc3RMZW5ndGhbdGFyZ2V0SW5kZXhdID0gZS50YXJnZXQudmFsdWUubGVuZ3RoOwogICAgICB2YXIgYXJyID0gW2tleUNvZGUsIHNlZWtUaW1lLCBwcmVzc1RpbWUsIFR5cGluZ0ROQS5wcmV2S2V5Q29kZSwgVHlwaW5nRE5BLnV0MSwgZS50YXJnZXQuaWQsXTsKICAgICAgVHlwaW5nRE5BLmhpc3RvcnkuYWRkKGFycik7CiAgICAgIFR5cGluZ0ROQS5wcmV2S2V5Q29kZSA9IGtleUNvZGU7CiAgICAgIGlmIChUeXBpbmdETkEuZGlhZ3JhbVJlY29yZGluZyA9PT0gdHJ1ZSkgewogICAgICAgIHZhciBhcnJEID0gW2tleUNvZGUsIHNlZWtUaW1lLCBwcmVzc1RpbWUsIGNoYXJDb2RlLCBUeXBpbmdETkEudXQxLCBlLnRhcmdldC5pZCwga3BHZXRbMV0uam9pbignLCcpLCBrcEdldFsyXS5qb2luKCcsJyksIGtwR2V0WzNdLmpvaW4oJywnKSwga3BHZXRbNF0uam9pbignLCcpXTsKICAgICAgICBUeXBpbmdETkEuaGlzdG9yeS5hZGREaWFncmFtKGFyckQpOwogICAgICB9CiAgICB9CgogICAgVHlwaW5nRE5BLm1vdXNlU2Nyb2xsID0gZnVuY3Rpb24oZSkgewogICAgICBpZiAoVHlwaW5nRE5BLm1vdXNlUmVjb3JkaW5nID09PSB0cnVlKSB7CiAgICAgICAgaWYgKFR5cGluZ0ROQS5tb3VzZU1vdmVSZWNvcmRpbmcgPT09IHRydWUpIHsKICAgICAgICAgIGlmIChUeXBpbmdETkEubW91c2Uuc2Nyb2xsU3RhcnRlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgY3VycmVudFRpbWUgPSAobmV3IERhdGUpLmdldFRpbWUoKTsKICAgICAgICAgICAgVHlwaW5nRE5BLm1vdXNlLnNjcm9sbFRpbWVzLnB1c2goY3VycmVudFRpbWUpOwogICAgICAgICAgICBUeXBpbmdETkEubW91c2Uuc2Nyb2xsVG9wQXJyLnB1c2goVHlwaW5nRE5BLmRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wKTsKICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChUeXBpbmdETkEuc2Nyb2xsSW50ZXJ2YWwpOwogICAgICAgICAgICBUeXBpbmdETkEuc2Nyb2xsSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChUeXBpbmdETkEubW91c2UuY2hlY2tTY3JvbGwsIFR5cGluZ0ROQS5tYXhTY3JvbGxEZWx0YVRpbWUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgVHlwaW5nRE5BLm1vdXNlLnNjcm9sbFN0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIFR5cGluZ0ROQS5tb3VzZU1vdmUgPSBmdW5jdGlvbihlKSB7CiAgICAgIGlmIChUeXBpbmdETkEubW91c2VSZWNvcmRpbmcgPT09IHRydWUpIHsKICAgICAgICB2YXIgY3VycmVudFRpbWUgPSAobmV3IERhdGUpLmdldFRpbWUoKTsKICAgICAgICBpZiAoVHlwaW5nRE5BLm1vdXNlTW92ZVJlY29yZGluZyA9PT0gdHJ1ZSkgewogICAgICAgICAgaWYgKFR5cGluZ0ROQS5tb3VzZS5zdGFydGVkID09PSB0cnVlKSB7CiAgICAgICAgICAgIFR5cGluZ0ROQS5tb3VzZS50aW1lcy5wdXNoKGN1cnJlbnRUaW1lKTsKICAgICAgICAgICAgVHlwaW5nRE5BLm1vdXNlLnhQb3NpdGlvbnMucHVzaChlLnNjcmVlblgpOwogICAgICAgICAgICBUeXBpbmdETkEubW91c2UueVBvc2l0aW9ucy5wdXNoKGUuc2NyZWVuWSk7CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoVHlwaW5nRE5BLm1vdmVJbnRlcnZhbCk7CiAgICAgICAgICAgIFR5cGluZ0ROQS5tb3ZlSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChUeXBpbmdETkEubW91c2UuY2hlY2tNb3ZlLCBUeXBpbmdETkEubWF4TW92ZURlbHRhVGltZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBUeXBpbmdETkEubW91c2Uuc3RhcnRlZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFR5cGluZ0ROQS5sYXN0TW91c2VNb3ZlVGltZSA9IGN1cnJlbnRUaW1lOwogICAgICB9CiAgICB9CgogICAgVHlwaW5nRE5BLm1vdXNlRG93biA9IGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKFR5cGluZ0ROQS5tb3VzZVJlY29yZGluZyA9PT0gdHJ1ZSkgewogICAgICAgIFR5cGluZ0ROQS5tb3VzZS5jaGVja01vdmUoKTsKICAgICAgICBUeXBpbmdETkEubW91c2UuY2hlY2tTY3JvbGwoKTsKICAgICAgICBpZiAoZS53aGljaCA9PT0gMSkgewogICAgICAgICAgVHlwaW5nRE5BLmxhc3RNb3VzZURvd25UaW1lID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7CiAgICAgICAgICB2YXIgc3RvcFRpbWUgPSBUeXBpbmdETkEubGFzdE1vdXNlRG93blRpbWUgLSBUeXBpbmdETkEubGFzdE1vdXNlTW92ZVRpbWU7CiAgICAgICAgICBpZiAoc3RvcFRpbWUgPCBUeXBpbmdETkEubWF4U3RvcFRpbWUgJiYgVHlwaW5nRE5BLmxhc3RNb3VzZVN0b3AgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIFR5cGluZ0ROQS5zdG9wVGltZXMucHVzaChzdG9wVGltZSk7CiAgICAgICAgICAgIGlmIChUeXBpbmdETkEubW91c2VNb3ZlUmVjb3JkaW5nID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgdmFyIGV2ZW50VHlwZSA9IDM7CiAgICAgICAgICAgICAgdmFyIGFyciA9IFtldmVudFR5cGUsIHN0b3BUaW1lLF07CiAgICAgICAgICAgICAgVHlwaW5nRE5BLm1vdXNlLmhpc3RvcnkuYWRkKGFycik7CiAgICAgICAgICAgICAgVHlwaW5nRE5BLmxhc3RNb3VzZVN0b3AgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgVHlwaW5nRE5BLm1vdXNlVXAgPSBmdW5jdGlvbihlKSB7CiAgICAgIGlmIChUeXBpbmdETkEubW91c2VSZWNvcmRpbmcgPT09IHRydWUpIHsKICAgICAgICBpZiAoZS53aGljaCA9PT0gMSkgewogICAgICAgICAgdmFyIGNsaWNrVGltZSA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpIC0gVHlwaW5nRE5BLmxhc3RNb3VzZURvd25UaW1lOwogICAgICAgICAgaWYgKGNsaWNrVGltZSA8IFR5cGluZ0ROQS5tYXhDbGlja1RpbWUpIHsKICAgICAgICAgICAgVHlwaW5nRE5BLmNsaWNrVGltZXMucHVzaChjbGlja1RpbWUpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKFR5cGluZ0ROQS5tb3VzZU1vdmVSZWNvcmRpbmcgPT09IHRydWUpIHsKICAgICAgICAgICAgaWYgKFR5cGluZ0ROQS5tb3VzZS5zdGFydGVkID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgVHlwaW5nRE5BLm1vdXNlLmNoZWNrTW92ZSh0cnVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgZXZlbnRUeXBlID0gNDsKICAgICAgICAgICAgICB2YXIgYXJyID0gW2V2ZW50VHlwZSwgY2xpY2tUaW1lLF07CiAgICAgICAgICAgICAgVHlwaW5nRE5BLm1vdXNlLmhpc3RvcnkuYWRkKGFycik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBUeXBpbmdETkEuaXNNb2JpbGUgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKFR5cGluZ0ROQS5tb2JpbGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBUeXBpbmdETkEubW9iaWxlOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBjaGVjayA9IDA7CiAgICAgICAgKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAvKGFuZHJvaWR8YmJcZCt8bWVlZ28pLittb2JpbGV8YXZhbnRnb3xiYWRhXC98YmxhY2tiZXJyeXxibGF6ZXJ8Y29tcGFsfGVsYWluZXxmZW5uZWN8aGlwdG9wfGllbW9iaWxlfGlwKGhvbmV8b2QpfGlyaXN8a2luZGxlfGxnZSB8bWFlbW98bWlkcHxtbXB8bW9iaWxlLitmaXJlZm94fG5ldGZyb250fG9wZXJhIG0ob2J8aW4paXxwYWxtKCBvcyk/fHBob25lfHAoaXhpfHJlKVwvfHBsdWNrZXJ8cG9ja2V0fHBzcHxzZXJpZXMoNHw2KTB8c3ltYmlhbnx0cmVvfHVwXC4oYnJvd3NlcnxsaW5rKXx2b2RhZm9uZXx3YXB8d2luZG93cyBjZXx4ZGF8eGlpbm98YW5kcm9pZHxpcGFkfHBsYXlib29rfHNpbGsvaQogICAgICAgICAgICAgICAgICAudGVzdChhKSB8fAogICAgICAgICAgICAgIC8xMjA3fDYzMTB8NjU5MHwzZ3NvfDR0aHB8NTBbMS02XWl8Nzcwc3w4MDJzfGEgd2F8YWJhY3xhYyhlcnxvb3xzXC0pfGFpKGtvfHJuKXxhbChhdnxjYXxjbyl8YW1vaXxhbihleHxueXx5dyl8YXB0dXxhcihjaHxnbyl8YXModGV8dXMpfGF0dHd8YXUoZGl8XC1tfHIgfHMgKXxhdmFufGJlKGNrfGxsfG5xKXxiaShsYnxyZCl8YmwoYWN8YXopfGJyKGV8dil3fGJ1bWJ8YndcLShufHUpfGM1NVwvfGNhcGl8Y2N3YXxjZG1cLXxjZWxsfGNodG18Y2xkY3xjbWRcLXxjbyhtcHxuZCl8Y3Jhd3xkYShpdHxsbHxuZyl8ZGJ0ZXxkY1wtc3xkZXZpfGRpY2F8ZG1vYnxkbyhjfHApb3xkcygxMnxcLWQpfGVsKDQ5fGFpKXxlbShsMnx1bCl8ZXIoaWN8azApfGVzbDh8ZXooWzQtN10wfG9zfHdhfHplKXxmZXRjfGZseShcLXxfKXxnMSB1fGc1NjB8Z2VuZXxnZlwtNXxnXC1tb3xnbyhcLnd8b2QpfGdyKGFkfHVuKXxoYWllfGhjaXR8aGRcLShtfHB8dCl8aGVpXC18aGkocHR8dGEpfGhwKCBpfGlwKXxoc1wtY3xodChjKFwtfCB8X3xhfGd8cHxzfHQpfHRwKXxodShhd3x0Yyl8aVwtKDIwfGdvfG1hKXxpMjMwfGlhYyggfFwtfFwvKXxpYnJvfGlkZWF8aWcwMXxpa29tfGltMWt8aW5ub3xpcGFxfGlyaXN8amEodHx2KWF8amJyb3xqZW11fGppZ3N8a2RkaXxrZWppfGtndCggfFwvKXxrbG9ufGtwdCB8a3djXC18a3lvKGN8ayl8bGUobm98eGkpfGxnKCBnfFwvKGt8bHx1KXw1MHw1NHxcLVthLXddKXxsaWJ3fGx5bnh8bTFcLXd8bTNnYXxtNTBcL3xtYSh0ZXx1aXx4byl8bWMoMDF8MjF8Y2EpfG1cLWNyfG1lKHJjfHJpKXxtaShvOHxvYXx0cyl8bW1lZnxtbygwMXwwMnxiaXxkZXxkb3x0KFwtfCB8b3x2KXx6eil8bXQoNTB8cDF8diApfG13YnB8bXl3YXxuMTBbMC0yXXxuMjBbMi0zXXxuMzAoMHwyKXxuNTAoMHwyfDUpfG43KDAoMHwxKXwxMCl8bmUoKGN8bSlcLXxvbnx0Znx3Znx3Z3x3dCl8bm9rKDZ8aSl8bnpwaHxvMmltfG9wKHRpfHd2KXxvcmFufG93ZzF8cDgwMHxwYW4oYXxkfHQpfHBkeGd8cGcoMTN8XC0oWzEtOF18YykpfHBoaWx8cGlyZXxwbChheXx1Yyl8cG5cLTJ8cG8oY2t8cnR8c2UpfHByb3h8cHNpb3xwdFwtZ3xxYVwtYXxxYygwN3wxMnwyMXwzMnw2MHxcLVsyLTddfGlcLSl8cXRla3xyMzgwfHI2MDB8cmFrc3xyaW05fHJvKHZlfHpvKXxzNTVcL3xzYShnZXxtYXxtbXxtc3xueXx2YSl8c2MoMDF8aFwtfG9vfHBcLSl8c2RrXC98c2UoYyhcLXwwfDEpfDQ3fG1jfG5kfHJpKXxzZ2hcLXxzaGFyfHNpZShcLXxtKXxza1wtMHxzbCg0NXxpZCl8c20oYWx8YXJ8YjN8aXR8dDUpfHNvKGZ0fG55KXxzcCgwMXxoXC18dlwtfHYgKXxzeSgwMXxtYil8dDIoMTh8NTApfHQ2KDAwfDEwfDE4KXx0YShndHxsayl8dGNsXC18dGRnXC18dGVsKGl8bSl8dGltXC18dFwtbW98dG8ocGx8c2gpfHRzKDcwfG1cLXxtM3xtNSl8dHhcLTl8dXAoXC5ifGcxfHNpKXx1dHN0fHY0MDB8djc1MHx2ZXJpfHZpKHJnfHRlKXx2ayg0MHw1WzAtM118XC12KXx2bTQwfHZvZGF8dnVsY3x2eCg1Mnw1M3w2MHw2MXw3MHw4MHw4MXw4M3w4NXw5OCl8dzNjKFwtfCApfHdlYmN8d2hpdHx3aShnIHxuY3xudyl8d21sYnx3b251fHg3MDB8eWFzXC18eW91cnx6ZXRvfHp0ZVwtL2kKICAgICAgICAgICAgICAgICAgLnRlc3QoYS5zdWJzdHIoMCwgNCkpKSB7CiAgICAgICAgICAgIGNoZWNrID0gMTsKICAgICAgICAgIH0KICAgICAgICB9KShuYXZpZ2F0b3IudXNlckFnZW50IHx8IG5hdmlnYXRvci52ZW5kb3IgfHwgd2luZG93Lm9wZXJhKTsKICAgICAgICBUeXBpbmdETkEubW9iaWxlID0gY2hlY2s7CiAgICAgICAgcmV0dXJuIGNoZWNrOwogICAgICB9CiAgICB9CgogICAgVHlwaW5nRE5BLmlzQW5kcm9pZCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gL0FuZHJvaWQvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpOwogICAgfQoKICAgIFR5cGluZ0ROQS5pc0ZpcmVmb3ggPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIC9GaXJlZm94L2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTsKICAgIH0KCiAgICBUeXBpbmdETkEuaXNUYXJnZXQgPSBmdW5jdGlvbih0YXJnZXQpIHsKICAgICAgaWYgKFR5cGluZ0ROQS5sYXN0VGFyZ2V0ID09PSB0YXJnZXQgJiYgVHlwaW5nRE5BLmxhc3RUYXJnZXRGb3VuZCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciB0YXJnZXRMZW5ndGggPSBUeXBpbmdETkEudGFyZ2V0SWRzLmxlbmd0aDsKICAgICAgICB2YXIgdGFyZ2V0Rm91bmQgPSBmYWxzZTsKICAgICAgICBpZiAodGFyZ2V0TGVuZ3RoID4gMCkgewogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YXJnZXRMZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoVHlwaW5nRE5BLnRhcmdldElkc1tpXSA9PT0gdGFyZ2V0KSB7CiAgICAgICAgICAgICAgdGFyZ2V0Rm91bmQgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBUeXBpbmdETkEubGFzdFRhcmdldCA9IHRhcmdldDsKICAgICAgICAgIFR5cGluZ0ROQS5sYXN0VGFyZ2V0Rm91bmQgPSB0YXJnZXRGb3VuZDsKICAgICAgICAgIHJldHVybiB0YXJnZXRGb3VuZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgVHlwaW5nRE5BLmxhc3RUYXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgICBUeXBpbmdETkEubGFzdFRhcmdldEZvdW5kID0gdHJ1ZTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIFR5cGluZ0ROQS5rcEFjY1ogPSBbXTsKICAgIFR5cGluZ0ROQS5rcFggPSBbXTsKICAgIFR5cGluZ0ROQS5rcFkgPSBbXTsKICAgIFR5cGluZ0ROQS5rcFRpbWVzID0gW107CiAgICBUeXBpbmdETkEua3BMYXN0WiA9IDA7CiAgICBUeXBpbmdETkEua3BMYXN0QWNjWCA9IDA7CiAgICBUeXBpbmdETkEua3BMYXN0QWNjWSA9IDA7CiAgICBUeXBpbmdETkEua3BMYXN0UGl0Y2ggPSAwOwogICAgVHlwaW5nRE5BLmtwTGFzdFJvbGwgPSAwOwogICAgVHlwaW5nRE5BLmxhc3RQcmVzc1RpbWUgPSAwOwogICAgVHlwaW5nRE5BLmhhc0RldmljZU1vdGlvbiA9IGZhbHNlOwogICAgVHlwaW5nRE5BLmhhc0RldmljZU9yaWVudGF0aW9uID0gZmFsc2U7CgogICAgVHlwaW5nRE5BLmRldmljZU1vdGlvbkhhbmRsZXIgPSBmdW5jdGlvbihlKSB7CiAgICAgIFR5cGluZ0ROQS5rcFRpbWVzLnB1c2goKG5ldyBEYXRlKS5nZXRUaW1lKCkpOwogICAgICB2YXIga3BDdXJBY2NYID0gTWF0aC5yb3VuZCgxMDAgKiBlLmFjY2VsZXJhdGlvbkluY2x1ZGluZ0dyYXZpdHkueCk7CiAgICAgIHZhciBrcEN1ckFjY1kgPSBNYXRoLnJvdW5kKDEwMCAqIGUuYWNjZWxlcmF0aW9uSW5jbHVkaW5nR3Jhdml0eS55KTsKICAgICAgdmFyIGtwQ3VyQWNjWiA9IE1hdGgucm91bmQoMTAwICogZS5hY2NlbGVyYXRpb25JbmNsdWRpbmdHcmF2aXR5LnopOwogICAgICBpZiAoZS5yb3RhdGlvblJhdGUpIHsKICAgICAgICB2YXIga3BDdXJYID0gTWF0aC5yb3VuZCgxMCAqIGUucm90YXRpb25SYXRlLmFscGhhKTsKICAgICAgICB2YXIga3BDdXJZID0gTWF0aC5yb3VuZCgxMCAqIGUucm90YXRpb25SYXRlLmJldGEpOwogICAgICAgIHZhciBrcEN1clogPSBNYXRoLnJvdW5kKDEwICogZS5yb3RhdGlvblJhdGUuZ2FtbWEpOwogICAgICB9CiAgICAgIFR5cGluZ0ROQS5rcExhc3RBY2NYID0ga3BDdXJBY2NYOwogICAgICBUeXBpbmdETkEua3BMYXN0QWNjWSA9IGtwQ3VyQWNjWTsKICAgICAgVHlwaW5nRE5BLmtwQWNjWi5wdXNoKGtwQ3VyQWNjWik7CiAgICAgIFR5cGluZ0ROQS5rcFgucHVzaChrcEN1clgpOwogICAgICBUeXBpbmdETkEua3BZLnB1c2goa3BDdXJZKTsKICAgICAgVHlwaW5nRE5BLmtwTGFzdFogPSBrcEN1clo7CgogICAgICBUeXBpbmdETkEua3BMYXN0UGl0Y2ggPSBNYXRoLmZsb29yKChNYXRoLmF0YW4yKC1rcEN1ckFjY1ksIE1hdGguc3FydChNYXRoLnBvdyhrcEN1ckFjY1gsIDIpICsgTWF0aC5wb3coa3BDdXJBY2NaLCAyKSkpICogMTgwIC8gTWF0aC5QSSkgKiAxMCk7CiAgICAgIFR5cGluZ0ROQS5rcExhc3RSb2xsID0gTWF0aC5mbG9vcigoTWF0aC5hdGFuMigta3BDdXJBY2NYLCBNYXRoLnNxcnQoTWF0aC5wb3coa3BDdXJBY2NZLCAyKSArIE1hdGgucG93KGtwQ3VyQWNjWiwgMikpKSAqIDE4MCAvIE1hdGguUEkpICogMTApOwogICAgICBpZiAoVHlwaW5nRE5BLmtwWC5sZW5ndGggPiAyMSkgewogICAgICAgIFR5cGluZ0ROQS5rcFRpbWVzLnNoaWZ0KCk7CiAgICAgICAgVHlwaW5nRE5BLmtwQWNjWi5zaGlmdCgpOwogICAgICAgIFR5cGluZ0ROQS5rcFguc2hpZnQoKTsKICAgICAgICBUeXBpbmdETkEua3BZLnNoaWZ0KCk7CiAgICAgIH0KICAgICAgaWYgKCFUeXBpbmdETkEuaGFzRGV2aWNlTW90aW9uKSB7CiAgICAgICAgVHlwaW5nRE5BLmhhc0RldmljZU1vdGlvbiA9IHRydWU7CiAgICAgICAgVHlwaW5nRE5BLmhhc0RldmljZU9yaWVudGF0aW9uID0gdHJ1ZTsKICAgICAgfQogICAgfQoKICAgIGlmIChUeXBpbmdETkEuaXNNb2JpbGUoKSA9PT0gMSkgewogICAgICBpZiAoVHlwaW5nRE5BLmlzQW5kcm9pZCgpKSB7CiAgICAgICAgaWYgKFR5cGluZ0ROQS5pc0ZpcmVmb3goKSkgewogICAgICAgICAgVHlwaW5nRE5BLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgVHlwaW5nRE5BLkFuZHJvaWRLZXlVcCk7CiAgICAgICAgICBUeXBpbmdETkEuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIFR5cGluZ0ROQS5BbmRyb2lkS2V5RG93bik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFR5cGluZ0ROQS5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJrZXl1cCIsIFR5cGluZ0ROQS5BbmRyb2lkS2V5VXApOwogICAgICAgICAgVHlwaW5nRE5BLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBUeXBpbmdETkEuQW5kcm9pZEtleURvd24pOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBUeXBpbmdETkEuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigia2V5dXAiLCBUeXBpbmdETkEuTW9iaWxlS2V5VXApOwogICAgICAgIFR5cGluZ0ROQS5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgVHlwaW5nRE5BLk1vYmlsZUtleURvd24pOwogICAgICAgIFR5cGluZ0ROQS5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJrZXlwcmVzcyIsIFR5cGluZ0ROQS5Nb2JpbGVLZXlQcmVzcyk7CiAgICAgIH0KICAgICAgaWYgKHdpbmRvdy5EZXZpY2VNb3Rpb25FdmVudCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2RldmljZW1vdGlvbicsIFR5cGluZ0ROQS5kZXZpY2VNb3Rpb25IYW5kbGVyKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaWYgKFR5cGluZ0ROQS5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgICAgVHlwaW5nRE5BLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgVHlwaW5nRE5BLmtleVVwKTsKICAgICAgICBUeXBpbmdETkEuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIFR5cGluZ0ROQS5rZXlEb3duKTsKICAgICAgICBUeXBpbmdETkEuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigia2V5cHJlc3MiLCBUeXBpbmdETkEua2V5UHJlc3MpOwogICAgICAgIFR5cGluZ0ROQS5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW1vdmUiLCBUeXBpbmdETkEubW91c2VNb3ZlKTsKICAgICAgICBUeXBpbmdETkEuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgVHlwaW5nRE5BLm1vdXNlRG93bik7CiAgICAgICAgVHlwaW5nRE5BLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNldXAiLCBUeXBpbmdETkEubW91c2VVcCk7CiAgICAgICAgVHlwaW5nRE5BLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInNjcm9sbCIsIFR5cGluZ0ROQS5tb3VzZVNjcm9sbCk7CiAgICAgIH0gZWxzZSBpZiAoVHlwaW5nRE5BLmRvY3VtZW50LmF0dGFjaEV2ZW50KSB7CiAgICAgICAgVHlwaW5nRE5BLmRvY3VtZW50LmF0dGFjaEV2ZW50KCJvbmtleXVwIiwgVHlwaW5nRE5BLmtleVVwKTsKICAgICAgICBUeXBpbmdETkEuZG9jdW1lbnQuYXR0YWNoRXZlbnQoIm9ua2V5ZG93biIsIFR5cGluZ0ROQS5rZXlEb3duKTsKICAgICAgICBUeXBpbmdETkEuZG9jdW1lbnQuYXR0YWNoRXZlbnQoIm9ua2V5cHJlc3MiLCBUeXBpbmdETkEua2V5UHJlc3MpOwogICAgICAgIFR5cGluZ0ROQS5kb2N1bWVudC5hdHRhY2hFdmVudCgib25tb3VzZW1vdmUiLCBUeXBpbmdETkEubW91c2VNb3ZlKTsKICAgICAgICBUeXBpbmdETkEuZG9jdW1lbnQuYXR0YWNoRXZlbnQoIm9ubW91c2Vkb3duIiwgVHlwaW5nRE5BLm1vdXNlRG93bik7CiAgICAgICAgVHlwaW5nRE5BLmRvY3VtZW50LmF0dGFjaEV2ZW50KCJvbm1vdXNldXAiLCBUeXBpbmdETkEubW91c2VVcCk7CiAgICAgICAgVHlwaW5nRE5BLmRvY3VtZW50LmF0dGFjaEV2ZW50KCJvbnNjcm9sbCIsIFR5cGluZ0ROQS5tb3VzZVNjcm9sbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5sb2coImJyb3dzZXIgbm90IHN1cHBvcnRlZCIpOwogICAgICB9CiAgICB9CgogICAgVHlwaW5nRE5BLmtwQURpZkFyciA9IGZ1bmN0aW9uKGFycikgewogICAgICB2YXIgbGVuZ3RoID0gYXJyLmxlbmd0aCAtIDE7CiAgICAgIHZhciBmaXJzdEFyciA9IFswXTsKICAgICAgaWYgKGxlbmd0aCA8IDIpIHsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgWzBdLAogICAgICAgICAgWzBdCiAgICAgICAgXTsKICAgICAgfQogICAgICB2YXIgbmV3QXJyID0gW107CiAgICAgIHZhciByZXR1cm5BcnIgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGZpcnN0QXJyLnB1c2goYXJyW2kgKyAxXSAtIGFycltpXSk7CiAgICAgIH0KICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIG5ld1ZhbCA9IGZpcnN0QXJyW2kgKyAxXSAtIGZpcnN0QXJyW2ldOwogICAgICAgIG5ld0Fyci5wdXNoKG5ld1ZhbCk7CiAgICAgICAgcmV0dXJuQXJyLnB1c2goTWF0aC5hYnMobmV3VmFsKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIFtuZXdBcnIsIHJldHVybkFycixdOwogICAgfQoKICAgIFR5cGluZ0ROQS5rcFJEaWZBcnIgPSBmdW5jdGlvbihhcnIpIHsKICAgICAgdmFyIGxlbmd0aCA9IGFyci5sZW5ndGggLSAyOwogICAgICB2YXIgZmlyc3RBcnIgPSBbXTsKICAgICAgaWYgKGxlbmd0aCA8IDApIHsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgWzBdLAogICAgICAgICAgWzBdCiAgICAgICAgXTsKICAgICAgfQogICAgICB2YXIgbG9jYWxNYXggPSAwOwogICAgICB2YXIgbG9jYWxNaW4gPSAwOwogICAgICB2YXIgcG9zTWF4ID0gMDsKICAgICAgdmFyIHBvc01pbiA9IDA7CiAgICAgIHZhciBuZXdWYWwgPSAwOwogICAgICBpZiAobGVuZ3RoID4gMCkgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgbmV3VmFsID0gYXJyW2kgKyAxXSAtIGFycltpXTsKICAgICAgICAgIGZpcnN0QXJyLnB1c2gobmV3VmFsKTsKICAgICAgICAgIGlmIChuZXdWYWwgPj0gbG9jYWxNYXgpIHsKICAgICAgICAgICAgbG9jYWxNYXggPSBuZXdWYWw7CiAgICAgICAgICAgIHBvc01heCA9IGk7CiAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbCA8PSBsb2NhbE1pbikgewogICAgICAgICAgICBsb2NhbE1pbiA9IG5ld1ZhbDsKICAgICAgICAgICAgcG9zTWluID0gaTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbmV3VmFsID0gYXJyWzFdIC0gYXJyWzBdOwogICAgICAgIGZpcnN0QXJyLnB1c2gobmV3VmFsKTsKICAgICAgfQogICAgICB2YXIgcmV0dXJuQXJyID0gW3Bvc01heCAtIDEsIHBvc01heCwgcG9zTWF4ICsgMSwgcG9zTWF4ICsgMiwgcG9zTWF4ICsgMywgcG9zTWluIC0gMSwgcG9zTWluLCBwb3NNaW4gKyAxLCBwb3NNaW4gKyAyLCBwb3NNaW4gKyAzXTsKICAgICAgcmV0dXJuIFtmaXJzdEFyciwgcmV0dXJuQXJyLF07CiAgICB9CgogICAgVHlwaW5nRE5BLmtwR2V0QWxsID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciByZXR1cm5WYWwgPSAwOwogICAgICB2YXIgcmV0dXJuTW90aW9uID0gW107CiAgICAgIGlmIChUeXBpbmdETkEua3BBY2NaLmxlbmd0aCA8IDIpIHsKICAgICAgICByZXR1cm5WYWwgPSAoVHlwaW5nRE5BLmhhc0RldmljZU1vdGlvbiAmJiBUeXBpbmdETkEuaGFzRGV2aWNlT3JpZW50YXRpb24pID8gMCA6IFR5cGluZ0ROQS5sYXN0UHJlc3NUaW1lOwogICAgICAgIHJldHVybk1vdGlvbiA9IFswLCAwLCAwLCAwLCAwLCAwLCBUeXBpbmdETkEua3BMYXN0UGl0Y2gsIFR5cGluZ0ROQS5rcExhc3RSb2xsLF07CiAgICAgICAgcmV0dXJuIFtyZXR1cm5WYWwsIHJldHVybk1vdGlvbiwgWzBdLAogICAgICAgICAgWzBdLAogICAgICAgICAgWzBdCiAgICAgICAgXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBba3B6YSwga3B6YUFic10gPSBUeXBpbmdETkEua3BBRGlmQXJyKFR5cGluZ0ROQS5rcEFjY1opOwogICAgICAgIFtrcFhSLCBrcHhQb3NdID0gVHlwaW5nRE5BLmtwUkRpZkFycihUeXBpbmdETkEua3BYKTsKICAgICAgICBba3BZUiwga3B5UG9zXSA9IFR5cGluZ0ROQS5rcFJEaWZBcnIoVHlwaW5nRE5BLmtwWSk7CiAgICAgICAgVHlwaW5nRE5BLmtwWC5zaGlmdCgpOwogICAgICAgIFR5cGluZ0ROQS5rcFkuc2hpZnQoKTsKICAgICAgICBUeXBpbmdETkEua3BBY2NaLnNoaWZ0KCk7CiAgICAgICAgVHlwaW5nRE5BLmtwVGltZXMuc2hpZnQoKTsKICAgICAgICB2YXIga3BQb3MgPSBrcHhQb3MuY29uY2F0KGtweVBvcyk7CiAgICAgICAga3BQb3MgPSBrcFBvcy5zb3J0KCk7CiAgICAgICAgdmFyIGtweHlQb3MgPSBbXTsKICAgICAgICBmb3IgKGkgPSAxOyBpIDwga3BQb3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChrcFBvc1tpXSAhPT0ga3BQb3NbaSAtIDFdKSB7CiAgICAgICAgICAgIGtweHlQb3MucHVzaChrcFBvc1tpXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBsYXN0S3B6YSA9IDA7CiAgICAgICAgdmFyIGxhc3RLcFRpbWUgPSBUeXBpbmdETkEua3BUaW1lc1tUeXBpbmdETkEua3BUaW1lcy5sZW5ndGggLSAxXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwga3B4eVBvcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIGogPSBrcHh5UG9zW2ldOwogICAgICAgICAgdmFyIG1pbmogPSAoa3B6YUFicy5sZW5ndGggPiA4KSA/IDIgOiAoKGtwemFBYnMubGVuZ3RoID4gNCkgPyAxIDogMCk7CiAgICAgICAgICBpZiAoaiA+IG1pbmogJiYga3B6YUFic1tqXSAhPT0gdW5kZWZpbmVkICYmIGtwemFBYnNbal0gPiBsYXN0S3B6YSkgewogICAgICAgICAgICBsYXN0S3B6YSA9IGtwemFBYnNbal07CiAgICAgICAgICAgIGxhc3RLcFRpbWUgPSBUeXBpbmdETkEua3BUaW1lc1tqXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuVmFsID0gbGFzdEtwVGltZTsKICAgICAgICByZXR1cm5Nb3Rpb24gPSBbVHlwaW5nRE5BLmtwTGFzdEFjY1gsIFR5cGluZ0ROQS5rcExhc3RBY2NZLCBUeXBpbmdETkEua3BBY2NaLnBvcCgpLCBUeXBpbmdETkEua3BYLnBvcCgpLCBUeXBpbmdETkEua3BZLnBvcCgpLCBUeXBpbmdETkEua3BMYXN0WiwgVHlwaW5nRE5BLmtwTGFzdFBpdGNoLCBUeXBpbmdETkEua3BMYXN0Um9sbF07CiAgICAgICAgVHlwaW5nRE5BLmtwWCA9IFtdOwogICAgICAgIFR5cGluZ0ROQS5rcFkgPSBbXTsKICAgICAgICBUeXBpbmdETkEua3BBY2NaID0gW107CiAgICAgICAgVHlwaW5nRE5BLmtwVGltZXMgPSBbXTsKICAgICAgICBpZiAoIVR5cGluZ0ROQS5wcmVzc0NhbGN1bGF0ZWQpIHsKICAgICAgICAgIFR5cGluZ0ROQS5wcmVzc0NhbGN1bGF0ZWQgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIFtyZXR1cm5WYWwsIHJldHVybk1vdGlvbiwga3B6YSwga3BYUiwga3BZUixdOwogICAgICB9CiAgICB9CgogICAgVHlwaW5nRE5BLm1vdXNlID0ge307CiAgICBUeXBpbmdETkEubW91c2UudGltZXMgPSBbXTsKICAgIFR5cGluZ0ROQS5tb3VzZS54UG9zaXRpb25zID0gW107CiAgICBUeXBpbmdETkEubW91c2UueVBvc2l0aW9ucyA9IFtdOwogICAgVHlwaW5nRE5BLm1vdXNlLnNjcm9sbFRpbWVzID0gW107CiAgICBUeXBpbmdETkEubW91c2Uuc2Nyb2xsVG9wQXJyID0gW107CiAgICBUeXBpbmdETkEubW91c2UuaGlzdG9yeSA9IHt9OwogICAgVHlwaW5nRE5BLm1vdXNlLmhpc3Rvcnkuc3RhY2sgPSBbXTsKCiAgICBUeXBpbmdETkEubW91c2UuZ2V0RGlzdGFuY2UgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKGEgKiBhKSArIChiICogYikpOwogICAgfQoKICAgIFR5cGluZ0ROQS5tb3VzZS5nZXRUb3RhbERpc3RhbmNlID0gZnVuY3Rpb24oeFBvc2l0aW9ucywgeVBvc2l0aW9ucykgewogICAgICB2YXIgdG90YWxEaXN0YW5jZSA9IDA7CiAgICAgIHZhciBsZW5ndGggPSB4UG9zaXRpb25zLmxlbmd0aDsKICAgICAgZm9yIChpID0gMTsgaSA8IGxlbmd0aCAtIDE7IGkrKykgewogICAgICAgIHZhciBhID0geFBvc2l0aW9uc1tpXSAtIHhQb3NpdGlvbnNbaSAtIDFdOwogICAgICAgIHZhciBiID0geVBvc2l0aW9uc1tpXSAtIHlQb3NpdGlvbnNbaSAtIDFdOwogICAgICAgIHRvdGFsRGlzdGFuY2UgKz0gVHlwaW5nRE5BLm1vdXNlLmdldERpc3RhbmNlKGEsIGIpOwogICAgICB9CiAgICAgIHJldHVybiB0b3RhbERpc3RhbmNlOwogICAgfQoKICAgIFR5cGluZ0ROQS5tb3VzZS5nZXRBbmdsZSA9IGZ1bmN0aW9uKHhQb3NEZWx0YSwgeVBvc0RlbHRhKSB7CiAgICAgIHZhciBhbmdsZSA9IDA7CiAgICAgIHZhciBsZWZ0UmlnaHQgPSAoeFBvc0RlbHRhID49IDApOyAvLyAxIGlmIGxlZnQsIDAgaWYgcmlnaHQKICAgICAgdmFyIGRvd25VcCA9ICh5UG9zRGVsdGEgPCAwKTsgLy8gMSBpZiBkb3duLCAwIGlmIHVwCiAgICAgIGlmIChsZWZ0UmlnaHQpIHsKICAgICAgICBpZiAoZG93blVwKSB7CiAgICAgICAgICBhbmdsZSA9IDE4MCArIChNYXRoLnJvdW5kKE1hdGguYXRhbihNYXRoLmFicyh4UG9zRGVsdGEpIC8gKE1hdGguYWJzKHlQb3NEZWx0YSkgKyAwLjAwMDAwMDEpKSAvIDAuMDE3NDUzMjkyNTEpKSAvLyAwLjAxNzQ1MzI5MjUxID0gcGkvMTgwCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFuZ2xlID0gMjcwICsgKDkwIC0gTWF0aC5yb3VuZChNYXRoLmF0YW4oTWF0aC5hYnMoeFBvc0RlbHRhKSAvIChNYXRoLmFicyh5UG9zRGVsdGEpICsgMC4wMDAwMDAxKSkgLyAwLjAxNzQ1MzI5MjUxKSkKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGRvd25VcCkgewogICAgICAgICAgYW5nbGUgPSA5MCArICg5MCAtIE1hdGgucm91bmQoTWF0aC5hdGFuKE1hdGguYWJzKHhQb3NEZWx0YSkgLyAoTWF0aC5hYnMoeVBvc0RlbHRhKSArIDAuMDAwMDAwMSkpIC8gMC4wMTc0NTMyOTI1MSkpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFuZ2xlID0gTWF0aC5yb3VuZChNYXRoLmF0YW4oTWF0aC5hYnMoeFBvc0RlbHRhKSAvIChNYXRoLmFicyh5UG9zRGVsdGEpICsgMC4wMDAwMDAxKSkgLyAwLjAxNzQ1MzI5MjUxKQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gYW5nbGU7CiAgICB9CgogICAgVHlwaW5nRE5BLm1vdXNlLnJlY29yZE1vdmVBY3Rpb24gPSBmdW5jdGlvbihkcmFnKSB7CiAgICAgIHZhciBsZW5ndGggPSBUeXBpbmdETkEubW91c2UudGltZXMubGVuZ3RoOwogICAgICBpZiAobGVuZ3RoIDwgMykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YXIgZGVsdGFUaW1lID0gVHlwaW5nRE5BLm1vdXNlLnRpbWVzW2xlbmd0aCAtIDFdIC0gVHlwaW5nRE5BLm1vdXNlLnRpbWVzWzBdOwogICAgICB2YXIgeFBvc0RlbHRhID0gVHlwaW5nRE5BLm1vdXNlLnhQb3NpdGlvbnNbbGVuZ3RoIC0gMV0gLSBUeXBpbmdETkEubW91c2UueFBvc2l0aW9uc1swXTsKICAgICAgdmFyIHlQb3NEZWx0YSA9IFR5cGluZ0ROQS5tb3VzZS55UG9zaXRpb25zW2xlbmd0aCAtIDFdIC0gVHlwaW5nRE5BLm1vdXNlLnlQb3NpdGlvbnNbMF07CiAgICAgIHZhciBkaXJlY3REaXN0YW5jZSA9IE1hdGgucm91bmQoVHlwaW5nRE5BLm1vdXNlLmdldERpc3RhbmNlKHhQb3NEZWx0YSwgeVBvc0RlbHRhKSk7CiAgICAgIHZhciB0b3RhbERpc3RhbmNlID0gTWF0aC5yb3VuZChUeXBpbmdETkEubW91c2UuZ2V0VG90YWxEaXN0YW5jZShUeXBpbmdETkEubW91c2UueFBvc2l0aW9ucywgVHlwaW5nRE5BLm1vdXNlLnlQb3NpdGlvbnMpKTsKICAgICAgdmFyIHJhdGlvRGlzdGFuY2UgPSBNYXRoLnJvdW5kKHRvdGFsRGlzdGFuY2UgKiAxMDAgLyBkaXJlY3REaXN0YW5jZSk7CiAgICAgIHZhciBzcGVlZCA9IE1hdGgucm91bmQoZGlyZWN0RGlzdGFuY2UgKiAxMDAgLyBkZWx0YVRpbWUpOwogICAgICB2YXIgYW5nbGUgPSBUeXBpbmdETkEubW91c2UuZ2V0QW5nbGUoeFBvc0RlbHRhLCB5UG9zRGVsdGEpOwogICAgICB2YXIgZXZlbnRUeXBlID0gZHJhZyA9PT0gdHJ1ZSA/IDUgOiAxOwogICAgICB2YXIgYXJyID0gW2V2ZW50VHlwZSwgZGVsdGFUaW1lLCBkaXJlY3REaXN0YW5jZSwgc3BlZWQsIGFuZ2xlLCByYXRpb0Rpc3RhbmNlLF07CiAgICAgIHZhciBhcnJMZW4gPSBhcnIubGVuZ3RoOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyckxlbjsgaSsrKSB7CiAgICAgICAgaWYgKGlzTmFOKGFycltpXSkpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KICAgICAgVHlwaW5nRE5BLm1vdXNlLmhpc3RvcnkuYWRkKGFycik7CiAgICAgIFR5cGluZ0ROQS5sYXN0TW91c2VTdG9wID0gZmFsc2U7CiAgICB9CgogICAgVHlwaW5nRE5BLm1vdXNlLnJlY29yZFNjcm9sbEFjdGlvbiA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgbGVuZ3RoID0gVHlwaW5nRE5BLm1vdXNlLnNjcm9sbFRpbWVzLmxlbmd0aDsKICAgICAgaWYgKGxlbmd0aCA8IDIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIGRlbHRhVGltZSA9IFR5cGluZ0ROQS5tb3VzZS5zY3JvbGxUaW1lc1tsZW5ndGggLSAxXSAtIFR5cGluZ0ROQS5tb3VzZS5zY3JvbGxUaW1lc1swXTsKICAgICAgdmFyIGRpcmVjdERpc3RhbmNlID0gVHlwaW5nRE5BLm1vdXNlLnNjcm9sbFRvcEFycltsZW5ndGggLSAxXSAtIFR5cGluZ0ROQS5tb3VzZS5zY3JvbGxUb3BBcnJbMF07CiAgICAgIHZhciBzcGVlZCA9IE1hdGgucm91bmQoZGlyZWN0RGlzdGFuY2UgKiAxMDAgLyBkZWx0YVRpbWUpOwogICAgICB2YXIgZXZlbnRUeXBlID0gMjsKICAgICAgdmFyIGFyciA9IFtldmVudFR5cGUsIGRlbHRhVGltZSwgZGlyZWN0RGlzdGFuY2UsIHNwZWVkLF07CiAgICAgIHZhciBhcnJMZW4gPSBhcnIubGVuZ3RoOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyckxlbjsgaSsrKSB7CiAgICAgICAgaWYgKGlzTmFOKGFycltpXSkgJiYgIWlzRmluaXRlKGFycltpXSkpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KICAgICAgVHlwaW5nRE5BLm1vdXNlLmhpc3RvcnkuYWRkKGFycik7CiAgICB9CgogICAgVHlwaW5nRE5BLm1vdXNlLmhpc3RvcnkuYWRkID0gZnVuY3Rpb24oYXJyKSB7CiAgICAgIHRoaXMuc3RhY2sucHVzaChhcnIpOwogICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPiBUeXBpbmdETkEubWF4TW91c2VIaXN0b3J5TGVuZ3RoKSB7CiAgICAgICAgdGhpcy5zdGFjay5zaGlmdCgpOwogICAgICB9CiAgICB9CgogICAgVHlwaW5nRE5BLm1vdXNlLmhpc3RvcnkuZ2V0RGlhZ3JhbSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgbW91c2VEaWFncmFtID0gdGhpcy5zdGFjay5qb2luKCd8Jyk7CiAgICAgIHZhciBkaWFncmFtVHlwZSA9IDk7IC8vIGZvciBtb3VzZSBkaWFncmFtCiAgICAgIHJldHVybiBbU3RyaW5nKFR5cGluZ0ROQS5pc01vYmlsZSgpKSArICcsJyArIFN0cmluZyhUeXBpbmdETkEudmVyc2lvbikgKyAnLCcgKyBUeXBpbmdETkEuZmxhZ3MgKyAnLCcgKyBkaWFncmFtVHlwZSArICcsMCwwLCcgKyBUeXBpbmdETkEuZ2V0U3BlY2lhbEtleXMoKSArCiAgICAgICcsJyArIFR5cGluZ0ROQS5nZXREZXZpY2VTaWduYXR1cmUoKSwgbW91c2VEaWFncmFtCiAgICAgIF0uam9pbignfCcpOwogICAgfQoKICAgIFR5cGluZ0ROQS5tb3VzZS5jbGVhckxhc3RNb3ZlID0gZnVuY3Rpb24oKSB7CiAgICAgIFR5cGluZ0ROQS5tb3VzZS50aW1lcyA9IFtdOwogICAgICBUeXBpbmdETkEubW91c2UueFBvc2l0aW9ucyA9IFtdOwogICAgICBUeXBpbmdETkEubW91c2UueVBvc2l0aW9ucyA9IFtdOwogICAgfQoKICAgIFR5cGluZ0ROQS5tb3VzZS5jaGVja01vdmUgPSBmdW5jdGlvbihkcmFnKSB7CiAgICAgIGNsZWFySW50ZXJ2YWwoVHlwaW5nRE5BLm1vdmVJbnRlcnZhbCk7CiAgICAgIGlmIChUeXBpbmdETkEubW91c2Uuc3RhcnRlZCA9PT0gdHJ1ZSkgewogICAgICAgIFR5cGluZ0ROQS5tb3VzZS5zdGFydGVkID0gZmFsc2U7CiAgICAgICAgVHlwaW5nRE5BLm1vdXNlLnJlY29yZE1vdmVBY3Rpb24oZHJhZyk7CiAgICAgICAgVHlwaW5nRE5BLm1vdXNlLmNsZWFyTGFzdE1vdmUoKTsKICAgICAgfQogICAgfQoKICAgIFR5cGluZ0ROQS5tb3VzZS5jbGVhckxhc3RTY3JvbGwgPSBmdW5jdGlvbigpIHsKICAgICAgVHlwaW5nRE5BLm1vdXNlLnNjcm9sbFRpbWVzID0gW107CiAgICAgIFR5cGluZ0ROQS5tb3VzZS5zY3JvbGxUb3BBcnIgPSBbXTsKICAgIH0KCiAgICBUeXBpbmdETkEubW91c2UuY2hlY2tTY3JvbGwgPSBmdW5jdGlvbigpIHsKICAgICAgY2xlYXJJbnRlcnZhbChUeXBpbmdETkEuc2Nyb2xsSW50ZXJ2YWwpOwogICAgICBpZiAoVHlwaW5nRE5BLm1vdXNlLnNjcm9sbFN0YXJ0ZWQgPT09IHRydWUpIHsKICAgICAgICBUeXBpbmdETkEubW91c2Uuc2Nyb2xsU3RhcnRlZCA9IGZhbHNlOwogICAgICAgIFR5cGluZ0ROQS5tb3VzZS5yZWNvcmRTY3JvbGxBY3Rpb24oKTsKICAgICAgICBUeXBpbmdETkEubW91c2UuY2xlYXJMYXN0U2Nyb2xsKCk7CiAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSB0YXJnZXQgdG8gdGhlIHRhcmdldElkcyBhcnJheS4KICAgICAqLwogICAgVHlwaW5nRE5BLmFkZFRhcmdldCA9IGZ1bmN0aW9uKHRhcmdldCkgewogICAgICB2YXIgdGFyZ2V0TGVuZ3RoID0gVHlwaW5nRE5BLnRhcmdldElkcy5sZW5ndGg7CiAgICAgIHZhciB0YXJnZXRGb3VuZCA9IGZhbHNlOwogICAgICBpZiAodGFyZ2V0TGVuZ3RoID4gMCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFyZ2V0TGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChUeXBpbmdETkEudGFyZ2V0SWRzW2ldID09PSB0YXJnZXQpIHsKICAgICAgICAgICAgdGFyZ2V0Rm91bmQgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCF0YXJnZXRGb3VuZCkgewogICAgICAgICAgVHlwaW5nRE5BLnRhcmdldElkcy5wdXNoKHRhcmdldCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIFR5cGluZ0ROQS50YXJnZXRJZHMucHVzaCh0YXJnZXQpOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGEgdGFyZ2V0IHRvIHRoZSB0YXJnZXRJZHMgYXJyYXkuCiAgICAgKi8KICAgIFR5cGluZ0ROQS5yZW1vdmVUYXJnZXQgPSBmdW5jdGlvbih0YXJnZXQpIHsKICAgICAgdmFyIHRhcmdldExlbmd0aCA9IFR5cGluZ0ROQS50YXJnZXRJZHMubGVuZ3RoOwogICAgICBpZiAodGFyZ2V0TGVuZ3RoID4gMCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFyZ2V0TGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChUeXBpbmdETkEudGFyZ2V0SWRzW2ldID09PSB0YXJnZXQpIHsKICAgICAgICAgICAgVHlwaW5nRE5BLnRhcmdldElkcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVzZXRzIHRoZSBoaXN0b3J5IHN0YWNrCiAgICAgKi8KICAgIFR5cGluZ0ROQS5yZXNldCA9IGZ1bmN0aW9uKGFsbCkgewogICAgICBUeXBpbmdETkEuaGlzdG9yeS5zdGFjayA9IFtdOwogICAgICBUeXBpbmdETkEuaGlzdG9yeS5zdGFja0RpYWdyYW0gPSBbXTsKICAgICAgVHlwaW5nRE5BLmNsaWNrVGltZXMgPSBbXTsKICAgICAgVHlwaW5nRE5BLnN0b3BUaW1lcyA9IFtdOwogICAgICBUeXBpbmdETkEuQUNJbnB1dExlbmd0aHMgPSB7CiAgICAgICAgaW5wdXRzOiBbXSwKICAgICAgICBsYXN0TGVuZ3RoOiBbXSwKICAgICAgfTsKICAgICAgaWYgKGFsbCA9PT0gdHJ1ZSkgewogICAgICAgIFR5cGluZ0ROQS5tb3VzZS5oaXN0b3J5LnN0YWNrID0gW107CiAgICAgIH0KICAgIH0KCiAgICBUeXBpbmdETkEucmVtb3ZlRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKFR5cGluZ0ROQS5pc01vYmlsZSgpID09PSAxKSB7CiAgICAgICAgaWYgKFR5cGluZ0ROQS5pc0FuZHJvaWQoKSkgewogICAgICAgICAgaWYgKFR5cGluZ0ROQS5pc0ZpcmVmb3goKSkgewogICAgICAgICAgICBUeXBpbmdETkEuZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCBUeXBpbmdETkEuQW5kcm9pZEtleVVwKTsKICAgICAgICAgICAgVHlwaW5nRE5BLmRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBUeXBpbmdETkEuQW5kcm9pZEtleURvd24pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgVHlwaW5nRE5BLmRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImtleXVwIiwgVHlwaW5nRE5BLkFuZHJvaWRLZXlVcCk7CiAgICAgICAgICAgIFR5cGluZ0ROQS5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgVHlwaW5nRE5BLkFuZHJvaWRLZXlEb3duKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgVHlwaW5nRE5BLmRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImtleXVwIiwgVHlwaW5nRE5BLk1vYmlsZUtleVVwKTsKICAgICAgICAgIFR5cGluZ0ROQS5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgVHlwaW5nRE5BLk1vYmlsZUtleURvd24pOwogICAgICAgICAgVHlwaW5nRE5BLmRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImtleXByZXNzIiwgVHlwaW5nRE5BLk1vYmlsZUtleVByZXNzKTsKICAgICAgICB9CiAgICAgICAgaWYgKHdpbmRvdy5EZXZpY2VNb3Rpb25FdmVudCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignZGV2aWNlbW90aW9uJywgVHlwaW5nRE5BLmRldmljZU1vdGlvbkhhbmRsZXIpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoVHlwaW5nRE5BLmRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIpIHsKICAgICAgICAgIFR5cGluZ0ROQS5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJrZXl1cCIsIFR5cGluZ0ROQS5rZXlVcCk7CiAgICAgICAgICBUeXBpbmdETkEuZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIFR5cGluZ0ROQS5rZXlEb3duKTsKICAgICAgICAgIFR5cGluZ0ROQS5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJrZXlwcmVzcyIsIFR5cGluZ0ROQS5rZXlQcmVzcyk7CiAgICAgICAgICBUeXBpbmdETkEuZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2Vtb3ZlIiwgVHlwaW5nRE5BLm1vdXNlTW92ZSk7CiAgICAgICAgICBUeXBpbmdETkEuZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgVHlwaW5nRE5BLm1vdXNlRG93bik7CiAgICAgICAgICBUeXBpbmdETkEuZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2V1cCIsIFR5cGluZ0ROQS5tb3VzZVVwKTsKICAgICAgICAgIFR5cGluZ0ROQS5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJzY3JvbGwiLCBUeXBpbmdETkEubW91c2VTY3JvbGwpOwogICAgICAgIH0gZWxzZSBpZiAoVHlwaW5nRE5BLmRvY3VtZW50LmRldGFjaEV2ZW50KSB7CiAgICAgICAgICBUeXBpbmdETkEuZG9jdW1lbnQuZGV0YWNoRXZlbnQoIm9ua2V5dXAiLCBUeXBpbmdETkEua2V5VXApOwogICAgICAgICAgVHlwaW5nRE5BLmRvY3VtZW50LmRldGFjaEV2ZW50KCJvbmtleWRvd24iLCBUeXBpbmdETkEua2V5RG93bik7CiAgICAgICAgICBUeXBpbmdETkEuZG9jdW1lbnQuZGV0YWNoRXZlbnQoIm9ua2V5cHJlc3MiLCBUeXBpbmdETkEua2V5UHJlc3MpOwogICAgICAgICAgVHlwaW5nRE5BLmRvY3VtZW50LmRldGFjaEV2ZW50KCJvbm1vdXNlbW92ZSIsIFR5cGluZ0ROQS5tb3VzZU1vdmUpOwogICAgICAgICAgVHlwaW5nRE5BLmRvY3VtZW50LmRldGFjaEV2ZW50KCJvbm1vdXNlZG93biIsIFR5cGluZ0ROQS5tb3VzZURvd24pOwogICAgICAgICAgVHlwaW5nRE5BLmRvY3VtZW50LmRldGFjaEV2ZW50KCJvbm1vdXNldXAiLCBUeXBpbmdETkEubW91c2VVcCk7CiAgICAgICAgICBUeXBpbmdETkEuZG9jdW1lbnQuZGV0YWNoRXZlbnQoIm9uc2Nyb2xsIiwgVHlwaW5nRE5BLm1vdXNlU2Nyb2xsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS5sb2coImJyb3dzZXIgbm90IHN1cHBvcnRlZCIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQXV0b21hdGljYWxseSBjYWxsZWQgYXQgaW5pdGlsaXphdGlvbi4gSXQgc3RhcnRzIHRoZSByZWNvcmRpbmcgb2Yga2V5c3Ryb2tlcy4KICAgICAqLwogICAgVHlwaW5nRE5BLnN0YXJ0ID0gZnVuY3Rpb24oKSB7CiAgICAgIFR5cGluZ0ROQS5kaWFncmFtUmVjb3JkaW5nID0gdHJ1ZTsKICAgICAgcmV0dXJuIFR5cGluZ0ROQS5yZWNvcmRpbmcgPSB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogRW5kcyB0aGUgcmVjb3JkaW5nIG9mIGZ1cnRoZXIga2V5c3Ryb2tlcy4gVG8gcmVzdGFydCByZWNvcmRpbmcgYWZ0ZXJ3YXJkcyB5b3UgY2FuCiAgICAgKiBlaXRoZXIgY2FsbCBUeXBpbmdETkEuc3RhcnQoKSBvciBjcmVhdGUgYSBuZXcgVHlwaW5nRE5BIG9iamVjdCBhZ2Fpbiwgbm90IHJlY29tbWVuZGVkLgogICAgICovCiAgICBUeXBpbmdETkEuc3RvcCA9IGZ1bmN0aW9uKCkgewogICAgICBUeXBpbmdETkEuZGlhZ3JhbVJlY29yZGluZyA9IGZhbHNlOwogICAgICByZXR1cm4gVHlwaW5nRE5BLnJlY29yZGluZyA9IGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogU3RhcnRzIHRoZSByZWNvcmRpbmcgb2YgbW91c2UgYWN0aXZpdHkuCiAgICAgKi8KICAgIFR5cGluZ0ROQS5zdGFydE1vdXNlID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBUeXBpbmdETkEubW91c2VSZWNvcmRpbmcgPSBUeXBpbmdETkEubW91c2VNb3ZlUmVjb3JkaW5nID0gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0b3BzIHRoZSByZWNvcmRpbmcgb2YgbW91c2UgYWN0aXZpdHkuCiAgICAgKi8KICAgIFR5cGluZ0ROQS5zdG9wTW91c2UgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIFR5cGluZ0ROQS5tb3VzZVJlY29yZGluZyA9IFR5cGluZ0ROQS5tb3VzZU1vdmVSZWNvcmRpbmcgPSBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlc2V0cyBtb3VzZSByZWNvcmRpbmcKICAgICAqLwogICAgVHlwaW5nRE5BLnJlc2V0TW91c2UgPSBmdW5jdGlvbihhbGwpIHsKICAgICAgaWYgKGFsbCA9PT0gdHJ1ZSkgewogICAgICAgIFR5cGluZ0ROQS5jbGlja1RpbWVzID0gW107CiAgICAgICAgVHlwaW5nRE5BLnN0b3BUaW1lcyA9IFtdOwogICAgICB9CiAgICAgIFR5cGluZ0ROQS5tb3VzZS5oaXN0b3J5LnN0YWNrID0gW107CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIGlzIHRoZSBtYWluIGZ1bmN0aW9uIHRoYXQgb3V0cHV0cyB0aGUgdHlwaW5nIHBhdHRlcm4gYXMgYSBTdHJpbmcKICAgICAqIHt0eXBlOk51bWJlciwgdGV4dDpTdHJpbmcsIHRleHRJZDpOdW1iZXIsIGxlbmd0aDogTnVtYmVyLCB0YXJnZXRJZDpTdHJpbmcsIGNhc2VTZW5zaXRpdmU6Qm9vbGVhbn0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmogYW4gb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzCiAgICAgKiAqICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgMCBmb3IgYW55dGV4dCBwYXR0ZXJuLCAxIGZvciBzYW1ldGV4dCBwYXR0ZXJuIChhbHNvIGNhbGxlZCBkaWFncmFtIHBhdHRlcm4pCiAgICAgKiAqICogYW5kIDIgZm9yIGV4dGVuZGVkIHBhdHRlcm4gKG1vc3QgdmVyc2F0aWxlLCBjYW4gcmVwbGFjZSBib3RoIGFueXRleHQgYW5kIHNhbWV0ZXh0IHBhdHRlcm5zKQogICAgICogKiAqIEBwYXJhbSB7TnVtYmVyfSBsZW5ndGggKE9wdGlvbmFsKSB0aGUgbGVuZ3RoIG9mIHRoZSB0ZXh0IGluIHRoZSBoaXN0b3J5IGZvciB3aGljaCB5b3Ugd2FudAogICAgICogKiAqIHRoZSB0eXBpbmcgcGF0dGVybi4gbGVuZ3RoIGlzIGlnbm9yZWQgd2hlbiB0ZXh0IG9yIHRhcmdldElkIGlzIHNldCAob3IgYm90aCkuCiAgICAgKiAqICogQHBhcmFtIHtTdHJpbmd9IHRleHQgIChPbmx5IGZvciB0eXBlIDEgYW5kIHR5cGUgMikgYSB0eXBlZCBzdHJpbmcgdGhhdCB5b3Ugd2FudCB0aGUgdHlwaW5nIHBhdHRlcm4gZm9yCiAgICAgKiAqICogQHBhcmFtIHtOdW1iZXJ9IHRleHRJZCAoT3B0aW9uYWwsIG9ubHkgZm9yIHR5cGUgMSBhbmQgdHlwZSAyKSBhIHBlcnNvbmFsaXplZCBpZCBmb3IgdGhlIHR5cGVkIHRleHQKICAgICAqICogKiBAcGFyYW0ge1N0cmluZ30gdGFyZ2V0SWQgKE9wdGlvbmFsKSBzcGVjaWZpZXMgaWYgcGF0dGVybiBpcyBvYnRhaW4gb25seSBmcm9tIHRleHQgdHlwZWQgaW4gYSBjZXJ0YWluIHRhcmdldAogICAgICogKiAqIEBwYXJhbSB7Qm9vbGVhbn0gY2FzZVNlbnNpdGl2ZSAoT3B0aW9uYWwsIGRlZmF1bHQ6IGZhbHNlKSBVc2VkIGlmIHlvdSBwYXNzIGEgdGV4dCBmb3IgdHlwZSAxIG9yIHR5cGUgMgogICAgICogKiAqIERFUFJFQ0FURUQgKiAqICogaW4gZmF2b3Igb2YgdHlwZSA9IDIgKiAqICoKICAgICAqICogKiBAcGFyYW0ge0Jvb2xlYW59IGV4dGVuZGVkIChPbmx5IGZvciB0eXBlIDEpIHNwZWNpZmllcyBpZiBmdWxsIGluZm9ybWF0aW9uIGFib3V0IHdoYXQgd2FzIHR5cGVkIGlzIHByb2R1Y2VkLAogICAgICogKiAqIGluY2x1ZGluZyB0aGUgYWN0dWFsIGtleSBwcmVzc2VkLCBpZiBmYWxzZSwgb25seSB0aGUgb3JkZXIgb2YgcHJlc3NlZCBrZXlzIGlzIGtlcHQgKG5vIGFjdHVhbCBjb250ZW50KQogICAgICogQHJldHVybiB7U3RyaW5nfSBBIHR5cGluZyBwYXR0ZXJuIGluIHN0cmluZyBmb3JtCiAgICAgKiBAZXhhbXBsZSB2YXIgdHlwaW5nUGF0dGVybiA9IHRkbmEuZ2V0VHlwaW5nUGF0dGVybih7dHlwZTowLCBsZW5ndGg6MTgwfSk7CiAgICAgKiBAZXhhbXBsZSB2YXIgdHlwaW5nUGF0dGVybiA9IHRkbmEuZ2V0VHlwaW5nUGF0dGVybih7dHlwZToxLCB0ZXh0OiJIZWxsbzVnMjE/KiJ9KTsKICAgICAqIEBleGFtcGxlIHZhciB0eXBpbmdQYXR0ZXJuID0gdGRuYS5nZXRUeXBpbmdQYXR0ZXJuKHt0eXBlOjIsIHRleHQ6ImV4YW1wbGVAbWFpbC5jb20ifSk7CiAgICAgKi8KICAgIFR5cGluZ0ROQS5nZXRUeXBpbmdQYXR0ZXJuID0gZnVuY3Rpb24ob2JqKSB7CiAgICAgIHZhciBzdHIgPSAnJzsKICAgICAgaWYgKHR5cGVvZiBvYmogPT09ICdvYmplY3QnKSB7CiAgICAgICAgc3dpdGNoIChvYmoudHlwZSkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICByZXR1cm4gVHlwaW5nRE5BLmdldChvYmoubGVuZ3RoLCBvYmoudGFyZ2V0SWQpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgc3RyID0gKG9iai50ZXh0ICE9PSB1bmRlZmluZWQpID8gb2JqLnRleHQgOiBvYmoubGVuZ3RoOwogICAgICAgICAgICByZXR1cm4gVHlwaW5nRE5BLmhpc3RvcnkuZ2V0RGlhZ3JhbShvYmouZXh0ZW5kZWQsIHN0ciwgb2JqLnRleHRJZCwgb2JqLnRhcmdldElkLCBvYmouY2FzZVNlbnNpdGl2ZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBzdHIgPSAob2JqLnRleHQgIT09IHVuZGVmaW5lZCkgPyBvYmoudGV4dCA6IG9iai5sZW5ndGg7CiAgICAgICAgICAgIHJldHVybiBUeXBpbmdETkEuaGlzdG9yeS5nZXREaWFncmFtKHRydWUsIHN0ciwgb2JqLnRleHRJZCwgb2JqLnRhcmdldElkLCBvYmouY2FzZVNlbnNpdGl2ZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcmV0dXJuIFR5cGluZ0ROQS5nZXQob2JqLmxlbmd0aCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gVHlwaW5nRE5BLmdldCgpOwogICAgICB9CiAgICB9CgogICAgVHlwaW5nRE5BLmdldERpYWdyYW0gPSBmdW5jdGlvbihzdHIsIHRleHRJZCkgewogICAgICByZXR1cm4gVHlwaW5nRE5BLmhpc3RvcnkuZ2V0RGlhZ3JhbShmYWxzZSwgc3RyLCB0ZXh0SWQsIHVuZGVmaW5lZCwgZmFsc2UpOwogICAgfQoKICAgIFR5cGluZ0ROQS5nZXRFeHRlbmRlZERpYWdyYW0gPSBmdW5jdGlvbihzdHIsIHRleHRJZCkgewogICAgICByZXR1cm4gVHlwaW5nRE5BLmhpc3RvcnkuZ2V0RGlhZ3JhbSh0cnVlLCBzdHIsIHRleHRJZCwgdW5kZWZpbmVkLCBmYWxzZSk7CiAgICB9CgogICAgVHlwaW5nRE5BLmdldE1vdXNlRGlhZ3JhbSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gVHlwaW5nRE5BLm1vdXNlLmhpc3RvcnkuZ2V0RGlhZ3JhbSgpOwogICAgfQogICAgVHlwaW5nRE5BLmdldFNwZWNpYWxLZXlzID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBUeXBpbmdETkEuaGlzdG9yeS5nZXRTcGVjaWFsS2V5cygpOwogICAgfQoKICAgIFR5cGluZ0ROQS5nZXQgPSBmdW5jdGlvbihsZW5ndGgsIHRhcmdldElkKSB7CiAgICAgIHZhciBoaXN0b3J5VG90YWxMZW5ndGggPSBUeXBpbmdETkEuaGlzdG9yeS5zdGFjay5sZW5ndGg7CiAgICAgIGlmIChsZW5ndGggPT09IHVuZGVmaW5lZCB8fCBsZW5ndGggPT09IDApIHsKICAgICAgICBsZW5ndGggPSBUeXBpbmdETkEuZGVmYXVsdEhpc3RvcnlMZW5ndGg7CiAgICAgIH0KICAgICAgaWYgKGxlbmd0aCA+IGhpc3RvcnlUb3RhbExlbmd0aCkgewogICAgICAgIGxlbmd0aCA9IGhpc3RvcnlUb3RhbExlbmd0aDsKICAgICAgfQogICAgICB2YXIgb2JqID0ge307CiAgICAgIHZhciBoaXN0b3J5RGF0YSA9IFR5cGluZ0ROQS5oaXN0b3J5LmdldChsZW5ndGgsICIiLCB0YXJnZXRJZCk7CiAgICAgIG9ialsnYXJyJ10gPSBoaXN0b3J5RGF0YVswXTsKICAgICAgdmFyIHRhcmdldExlbmd0aCA9IGhpc3RvcnlEYXRhWzFdOwogICAgICBpZiAodGFyZ2V0SWQgIT09IHVuZGVmaW5lZCAmJiB0YXJnZXRJZCAhPT0gIiIpIHsKICAgICAgICBsZW5ndGggPSB0YXJnZXRMZW5ndGg7CiAgICAgIH0KICAgICAgdmFyIHpsID0gVHlwaW5nRE5BLnpsOwogICAgICB2YXIgaGlzdFJldiA9IGxlbmd0aDsKICAgICAgdmFyIGhpc3RTa3RGID0gVHlwaW5nRE5BLm1hdGguZm8oVHlwaW5nRE5BLmhpc3RvcnkuZ2V0KGxlbmd0aCwgInNlZWsiLCB0YXJnZXRJZCkpOwogICAgICB2YXIgaGlzdFBydEYgPSBUeXBpbmdETkEubWF0aC5mbyhUeXBpbmdETkEuaGlzdG9yeS5nZXQobGVuZ3RoLCAicHJlc3MiLCB0YXJnZXRJZCkpOwogICAgICB2YXIgcHJlc3NIaXN0TWVhbiA9IE1hdGgucm91bmQoVHlwaW5nRE5BLm1hdGguYXZnKGhpc3RQcnRGKSk7CiAgICAgIHZhciBzZWVrSGlzdE1lYW4gPSBNYXRoLnJvdW5kKFR5cGluZ0ROQS5tYXRoLmF2ZyhoaXN0U2t0RikpOwogICAgICB2YXIgcHJlc3NIaXN0U0QgPSBNYXRoLnJvdW5kKFR5cGluZ0ROQS5tYXRoLnNkKGhpc3RQcnRGKSk7CiAgICAgIHZhciBzZWVrSGlzdFNEID0gTWF0aC5yb3VuZChUeXBpbmdETkEubWF0aC5zZChoaXN0U2t0RikpOwogICAgICB2YXIgY2hhck1lYW5UaW1lID0gc2Vla0hpc3RNZWFuICsgcHJlc3NIaXN0TWVhbjsKICAgICAgdmFyIHByZXNzUmF0aW8gPSBUeXBpbmdETkEubWF0aC5yZCgocHJlc3NIaXN0TWVhbiArIHpsKSAvIChjaGFyTWVhblRpbWUgKyB6bCksIDQpOwogICAgICB2YXIgc2Vla1RvUHJlc3NSYXRpbyA9IFR5cGluZ0ROQS5tYXRoLnJkKCgxIC0gcHJlc3NSYXRpbykgLyBwcmVzc1JhdGlvLCA0KTsKICAgICAgdmFyIHByZXNzU0RUb1ByZXNzUmF0aW8gPSBUeXBpbmdETkEubWF0aC5yZCgocHJlc3NIaXN0U0QgKyB6bCkgLyAocHJlc3NIaXN0TWVhbiArIHpsKSwgNCk7CiAgICAgIHZhciBzZWVrU0RUb1ByZXNzUmF0aW8gPSBUeXBpbmdETkEubWF0aC5yZCgoc2Vla0hpc3RTRCArIHpsKSAvIChwcmVzc0hpc3RNZWFuICsgemwpLCA0KTsKICAgICAgdmFyIGNwbSA9IE1hdGgucm91bmQoNkU0IC8gKGNoYXJNZWFuVGltZSArIHpsKSk7CiAgICAgIGlmIChoaXN0UmV2ID09PSAwKSB7CiAgICAgICAgY3BtID0gMDsKICAgICAgfQogICAgICB2YXIgYXJyID0gW107CiAgICAgIGZvciAodmFyIGkgaW4gb2JqLmFycikgewogICAgICAgIHZhciByZXYgPSBvYmouYXJyW2ldWzFdLmxlbmd0aDsKICAgICAgICB2YXIgc2Vla01lYW4gPSAwOwogICAgICAgIHZhciBwcmVzc01lYW4gPSAwOwogICAgICAgIHZhciBwb3N0TWVhbiA9IDA7CiAgICAgICAgdmFyIHNlZWtTRCA9IDA7CiAgICAgICAgdmFyIHByZXNzU0QgPSAwOwogICAgICAgIHZhciBwb3N0U0QgPSAwOwogICAgICAgIHN3aXRjaCAob2JqLmFycltpXVswXS5sZW5ndGgpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHNlZWtNZWFuID0gVHlwaW5nRE5BLm1hdGgucmQoKG9iai5hcnJbaV1bMF1bMF0gKyB6bCkgLyAoc2Vla0hpc3RNZWFuICsgemwpLCA0KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBhcnIgPSBUeXBpbmdETkEubWF0aC5mbyhvYmouYXJyW2ldWzBdKTsKICAgICAgICAgICAgc2Vla01lYW4gPSBUeXBpbmdETkEubWF0aC5yZCgoVHlwaW5nRE5BLm1hdGguYXZnKGFycikgKyB6bCkgLyAoc2Vla0hpc3RNZWFuICsgemwpLCA0KTsKICAgICAgICAgICAgc2Vla1NEID0gVHlwaW5nRE5BLm1hdGgucmQoKFR5cGluZ0ROQS5tYXRoLnNkKGFycikgKyB6bCkgLyAoc2Vla0hpc3RTRCArIHpsKSwgNCk7CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAob2JqLmFycltpXVsxXS5sZW5ndGgpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHByZXNzTWVhbiA9IFR5cGluZ0ROQS5tYXRoLnJkKChvYmouYXJyW2ldWzFdWzBdICsgemwpIC8gKHByZXNzSGlzdE1lYW4gKyB6bCksIDQpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGFyciA9IFR5cGluZ0ROQS5tYXRoLmZvKG9iai5hcnJbaV1bMV0pOwogICAgICAgICAgICBwcmVzc01lYW4gPSBUeXBpbmdETkEubWF0aC5yZCgoVHlwaW5nRE5BLm1hdGguYXZnKGFycikgKyB6bCkgLyAocHJlc3NIaXN0TWVhbiArIHpsKSwgNCk7CiAgICAgICAgICAgIHByZXNzU0QgPSBUeXBpbmdETkEubWF0aC5yZCgoVHlwaW5nRE5BLm1hdGguc2QoYXJyKSArIHpsKSAvIChwcmVzc0hpc3RTRCArIHpsKSwgNCk7CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAob2JqLmFycltpXVsyXS5sZW5ndGgpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHBvc3RNZWFuID0gVHlwaW5nRE5BLm1hdGgucmQoKG9iai5hcnJbaV1bMl1bMF0gKyB6bCkgLyAoc2Vla0hpc3RNZWFuICsgemwpLCA0KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBhcnIgPSBUeXBpbmdETkEubWF0aC5mbyhvYmouYXJyW2ldWzJdKTsKICAgICAgICAgICAgcG9zdE1lYW4gPSBUeXBpbmdETkEubWF0aC5yZCgoVHlwaW5nRE5BLm1hdGguYXZnKGFycikgKyB6bCkgLyAoc2Vla0hpc3RNZWFuICsgemwpLCA0KTsKICAgICAgICAgICAgcG9zdFNEID0gVHlwaW5nRE5BLm1hdGgucmQoKFR5cGluZ0ROQS5tYXRoLnNkKGFycikgKyB6bCkgLyAoc2Vla0hpc3RTRCArIHpsKSwgNCk7CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBvYmouYXJyW2ldWzJdOwogICAgICAgIGRlbGV0ZSBvYmouYXJyW2ldWzFdOwogICAgICAgIGRlbGV0ZSBvYmouYXJyW2ldWzBdOwogICAgICAgIG9iai5hcnJbaV1bMF0gPSByZXY7CiAgICAgICAgb2JqLmFycltpXVsxXSA9IHNlZWtNZWFuOwogICAgICAgIG9iai5hcnJbaV1bMl0gPSBwcmVzc01lYW47CiAgICAgICAgb2JqLmFycltpXVszXSA9IHBvc3RNZWFuOwogICAgICAgIG9iai5hcnJbaV1bNF0gPSBzZWVrU0Q7CiAgICAgICAgb2JqLmFycltpXVs1XSA9IHByZXNzU0Q7CiAgICAgICAgb2JqLmFycltpXVs2XSA9IHBvc3RTRDsKICAgICAgfQogICAgICBhcnIgPSBbXTsKICAgICAgVHlwaW5nRE5BLmFwdShhcnIsIGhpc3RSZXYpOwogICAgICBUeXBpbmdETkEuYXB1KGFyciwgY3BtKTsKICAgICAgVHlwaW5nRE5BLmFwdShhcnIsIGNoYXJNZWFuVGltZSk7CiAgICAgIFR5cGluZ0ROQS5hcHUoYXJyLCBwcmVzc1JhdGlvKTsKICAgICAgVHlwaW5nRE5BLmFwdShhcnIsIHNlZWtUb1ByZXNzUmF0aW8pOwogICAgICBUeXBpbmdETkEuYXB1KGFyciwgcHJlc3NTRFRvUHJlc3NSYXRpbyk7CiAgICAgIFR5cGluZ0ROQS5hcHUoYXJyLCBzZWVrU0RUb1ByZXNzUmF0aW8pOwogICAgICBUeXBpbmdETkEuYXB1KGFyciwgcHJlc3NIaXN0TWVhbik7CiAgICAgIFR5cGluZ0ROQS5hcHUoYXJyLCBzZWVrSGlzdE1lYW4pOwogICAgICBUeXBpbmdETkEuYXB1KGFyciwgcHJlc3NIaXN0U0QpOwogICAgICBUeXBpbmdETkEuYXB1KGFyciwgc2Vla0hpc3RTRCk7CiAgICAgIGZvciAodmFyIGMgPSAwOyBjIDw9IDY7IGMrKykgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCA0NDsgaSsrKSB7CiAgICAgICAgICB2YXIga2V5Q29kZSA9IFR5cGluZ0ROQS5rZXlDb2Rlc1tpXTsKICAgICAgICAgIHZhciB2YWwgPSBvYmouYXJyW2tleUNvZGVdW2NdOwogICAgICAgICAgaWYgKHZhbCA9PT0gMCAmJiBjID4gMCkgewogICAgICAgICAgICB2YWwgPSAxOwogICAgICAgICAgfQogICAgICAgICAgVHlwaW5nRE5BLmFwdShhcnIsIHZhbCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIFR5cGluZ0ROQS5hcHUoYXJyLCBUeXBpbmdETkEuaXNNb2JpbGUoKSk7CiAgICAgIFR5cGluZ0ROQS5hcHUoYXJyLCBUeXBpbmdETkEudmVyc2lvbik7CiAgICAgIFR5cGluZ0ROQS5hcHUoYXJyLCBUeXBpbmdETkEuZmxhZ3MpOwogICAgICBUeXBpbmdETkEuYXB1KGFyciwgLTEpOyAvLyBkaWFncmFtVHlwZQogICAgICBUeXBpbmdETkEuYXB1KGFyciwgaGlzdFJldik7CiAgICAgIFR5cGluZ0ROQS5hcHUoYXJyLCAwKTsgLy8gdGV4dElkCiAgICAgIGFyci5wdXNoKFR5cGluZ0ROQS5nZXRTcGVjaWFsS2V5cygpKTsKICAgICAgYXJyLnB1c2goVHlwaW5nRE5BLmdldERldmljZVNpZ25hdHVyZSgpKTsKICAgICAgcmV0dXJuIGFyci5qb2luKCIsIik7CiAgICB9CgogICAgVHlwaW5nRE5BLmFwdSA9IGZ1bmN0aW9uKGFyciwgdmFsKSB7CiAgICAgICJOYU4iID09PSBTdHJpbmcodmFsKSAmJiAodmFsID0gMCk7CiAgICAgIGFyci5wdXNoKHZhbCk7CiAgICB9CgogICAgVHlwaW5nRE5BLm1hdGggPSB7fTsKCiAgICBUeXBpbmdETkEubWF0aC5yZCA9IGZ1bmN0aW9uKHZhbCwgZGVjKSB7CiAgICAgIHJldHVybiBOdW1iZXIodmFsLnRvRml4ZWQoZGVjKSk7CiAgICB9CgogICAgVHlwaW5nRE5BLm1hdGguYXZnID0gZnVuY3Rpb24oYXJyKSB7CiAgICAgIHZhciBsZW4gPSBhcnIubGVuZ3RoOwogICAgICBpZiAobGVuID4gMCkgewogICAgICAgIHZhciBzdW0gPSAwOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIHN1bSArPSBhcnJbaV07CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLnJkKHN1bSAvIGxlbiwgNCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgIH0KCiAgICBUeXBpbmdETkEubWF0aC5zZCA9IGZ1bmN0aW9uKGFycikgewogICAgICB2YXIgbGVuID0gYXJyLmxlbmd0aDsKICAgICAgaWYgKGxlbiA8IDIpIHsKICAgICAgICByZXR1cm4gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgc3VtVlMgPSAwOwogICAgICAgIHZhciBtZWFuID0gdGhpcy5hdmcoYXJyKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBzdW1WUyArPSAoYXJyW2ldIC0gbWVhbikgKiAoYXJyW2ldIC0gbWVhbik7CiAgICAgICAgfQogICAgICAgIHZhciBzZCA9IE1hdGguc3FydChzdW1WUyAvIGxlbik7CiAgICAgICAgcmV0dXJuIHNkOwogICAgICB9CiAgICB9CgogICAgVHlwaW5nRE5BLm1hdGguZm8gPSBmdW5jdGlvbihhcnIpIHsKICAgICAgaWYgKGFyci5sZW5ndGggPiAxKSB7CiAgICAgICAgdmFyIHZhbHVlcyA9IGFyci5jb25jYXQoKTsKICAgICAgICB2YXIgbGVuID0gYXJyLmxlbmd0aDsKICAgICAgICB2YWx1ZXMuc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICByZXR1cm4gYSAtIGI7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGFzZCA9IHRoaXMuc2QodmFsdWVzKTsKICAgICAgICB2YXIgYU1lYW4gPSB2YWx1ZXNbTWF0aC5jZWlsKGFyci5sZW5ndGggLyAyKV07CiAgICAgICAgdmFyIG11bHRpcGxpZXIgPSAyOwogICAgICAgIHZhciBtYXhWYWwgPSBhTWVhbiArIG11bHRpcGxpZXIgKiBhc2Q7CiAgICAgICAgdmFyIG1pblZhbCA9IGFNZWFuIC0gbXVsdGlwbGllciAqIGFzZDsKICAgICAgICBpZiAobGVuIDwgMjApIHsKICAgICAgICAgIG1pblZhbCA9IDA7CiAgICAgICAgfQogICAgICAgIHZhciBmVmFsID0gW107CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgdmFyIHRlbXB2YWwgPSB2YWx1ZXNbaV07CiAgICAgICAgICBpZiAodGVtcHZhbCA8IG1heFZhbCAmJiB0ZW1wdmFsID4gbWluVmFsKSB7CiAgICAgICAgICAgIGZWYWwucHVzaCh0ZW1wdmFsKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZWYWw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGFycjsKICAgICAgfQogICAgfQoKICAgIC8vIENhbGN1bGF0ZSBhIDMyIGJpdCBGTlYtMWEgaGFzaAogICAgVHlwaW5nRE5BLm1hdGguZm52MWFIYXNoID0gZnVuY3Rpb24oc3RyKSB7CiAgICAgIGlmIChzdHIgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2Ygc3RyICE9PSAnc3RyaW5nJykgewogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIHN0ciA9IHN0ci50b0xvd2VyQ2FzZSgpOwogICAgICB2YXIgaSwgbDsKICAgICAgdmFyIGh2YWwgPSAweDcyMWI1YWQ0OwogICAgICBmb3IgKGkgPSAwLCBsID0gc3RyLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGh2YWwgXj0gc3RyLmNoYXJDb2RlQXQoaSk7CiAgICAgICAgaHZhbCArPSAoaHZhbCA8PCAxKSArIChodmFsIDw8IDQpICsgKGh2YWwgPDwgNykgKyAoaHZhbCA8PCA4KSArIChodmFsIDw8IDI0KTsKICAgICAgfQogICAgICByZXR1cm4gaHZhbCA+Pj4gMDsKICAgIH0KCiAgICBUeXBpbmdETkEuaGlzdG9yeSA9IHt9OwogICAgVHlwaW5nRE5BLmhpc3Rvcnkuc3RhY2sgPSBbXTsKICAgIFR5cGluZ0ROQS5oaXN0b3J5LnN0YWNrRGlhZ3JhbSA9IFtdOwoKICAgIFR5cGluZ0ROQS5oaXN0b3J5LmFkZCA9IGZ1bmN0aW9uKGFycikgewogICAgICB0aGlzLnN0YWNrLnB1c2goYXJyKTsKICAgICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoID4gVHlwaW5nRE5BLm1heEhpc3RvcnlMZW5ndGgpIHsKICAgICAgICB0aGlzLnN0YWNrLnNoaWZ0KCk7CiAgICAgIH0KICAgIH0KCiAgICBUeXBpbmdETkEuaGlzdG9yeS5hZGREaWFncmFtID0gZnVuY3Rpb24oYXJyKSB7CiAgICAgIHRoaXMuc3RhY2tEaWFncmFtLnB1c2goYXJyKTsKICAgIH0KCiAgICBUeXBpbmdETkEuaGlzdG9yeS5nZXREaWFncmFtID0gZnVuY3Rpb24oZXh0ZW5kZWQsIHN0ciwgdGV4dElkLCB0YXJnZXRJZCwgY2FzZVNlbnNpdGl2ZSkgewogICAgICBjYXNlU2Vuc2l0aXZlID0gKGNhc2VTZW5zaXRpdmUgIT09IHVuZGVmaW5lZCkgPyBjYXNlU2Vuc2l0aXZlIDogKHN0ciA9PT0gdW5kZWZpbmVkIHx8IHN0ciA9PT0gIiIpOwogICAgICB2YXIgcmV0dXJuQXJyID0gW107CiAgICAgIHZhciBtb3Rpb25BcnIgPSBbXTsKICAgICAgdmFyIGtwemFBcnIgPSBbXTsKICAgICAgdmFyIGtweHJBcnIgPSBbXTsKICAgICAgdmFyIGtweXJBcnIgPSBbXTsKICAgICAgdmFyIG1vYmlsZSA9IEJvb2xlYW4oVHlwaW5nRE5BLmlzTW9iaWxlKCkpOwogICAgICB2YXIgZGlhZ3JhbVR5cGUgPSAoZXh0ZW5kZWQgPT09IHRydWUpID8gMSA6IDA7CiAgICAgIHZhciBzdGFja0RpYWdyYW0gPSB0aGlzLnN0YWNrRGlhZ3JhbTsKICAgICAgdmFyIGVsZW1lbnQgPSB7fTsKICAgICAgaWYgKHRhcmdldElkICE9PSB1bmRlZmluZWQgJiYgdGFyZ2V0SWQgIT09ICIiICYmIHN0YWNrRGlhZ3JhbS5sZW5ndGggPiAwKSB7CiAgICAgICAgc3RhY2tEaWFncmFtID0gVHlwaW5nRE5BLnNsaWNlU3RhY2tCeVRhcmdldElkKHN0YWNrRGlhZ3JhbSwgdGFyZ2V0SWQpOwogICAgICAgIGlmIChzdHIgPT09IHVuZGVmaW5lZCB8fCBzdHIgPT09ICIiKSB7CiAgICAgICAgICBlbGVtZW50ID0gVHlwaW5nRE5BLmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhcmdldElkKTsKICAgICAgICAgIGlmIChlbGVtZW50ICE9IG51bGwpIHsKICAgICAgICAgICAgc3RyID0gZWxlbWVudC52YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHRhcmdldExlbmd0aCA9IFR5cGluZ0ROQS50YXJnZXRJZHMubGVuZ3RoOwogICAgICAgIGlmIChzdHIgPT09IHVuZGVmaW5lZCB8fCBzdHIgPT09ICIiKSB7CiAgICAgICAgICBpZiAodGFyZ2V0TGVuZ3RoID4gMCkgewogICAgICAgICAgICBzdHIgPSAiIjsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YXJnZXRMZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGVsZW1lbnQgPSBUeXBpbmdETkEuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoVHlwaW5nRE5BLnRhcmdldElkc1tpXSk7CiAgICAgICAgICAgICAgaWYgKGVsZW1lbnQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgc3RyICs9IGVsZW1lbnQudmFsdWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoIWV4dGVuZGVkKSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coIlBsZWFzZSBwcm92aWRlIGEgZml4ZWQgc3RyaW5nIHBhcmFtIE9SIHVzZSB0aGUgYWRkVGFyZ2V0IG1ldGhvZC4iKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgbWlzc2luZ0NvdW50ID0gMDsKICAgICAgdmFyIGRpYWdyYW1IaXN0b3J5TGVuZ3RoID0gc3RhY2tEaWFncmFtLmxlbmd0aDsKICAgICAgdmFyIHN0ckxlbmd0aCA9IGRpYWdyYW1IaXN0b3J5TGVuZ3RoOwogICAgICBpZiAodHlwZW9mIHN0ciA9PT0gJ3N0cmluZycpIHsKICAgICAgICBzdHJMZW5ndGggPSBzdHIubGVuZ3RoOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBzdHIgPT09ICdudW1iZXInICYmIHN0ciA8IGRpYWdyYW1IaXN0b3J5TGVuZ3RoKSB7CiAgICAgICAgc3RyTGVuZ3RoID0gc3RyOwogICAgICB9CiAgICAgIHZhciByZXR1cm5UZXh0SWQgPSAwOwogICAgICBpZiAodGV4dElkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAoaXNOYU4ocGFyc2VJbnQodGV4dElkKSkpIHsKICAgICAgICAgIHJldHVyblRleHRJZCA9IFR5cGluZ0ROQS5tYXRoLmZudjFhSGFzaCh0ZXh0SWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm5UZXh0SWQgPSBwYXJzZUludCh0ZXh0SWQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodHlwZW9mIHN0ciA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIHJldHVyblRleHRJZCA9IFR5cGluZ0ROQS5tYXRoLmZudjFhSGFzaChzdHIpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm5BcnIucHVzaChbVHlwaW5nRE5BLmlzTW9iaWxlKCksIFR5cGluZ0ROQS52ZXJzaW9uLCBUeXBpbmdETkEuZmxhZ3MsIGRpYWdyYW1UeXBlLCBzdHJMZW5ndGgsCiAgICAgICAgcmV0dXJuVGV4dElkLCBUeXBpbmdETkEuZ2V0U3BlY2lhbEtleXMoKSwgVHlwaW5nRE5BLmdldERldmljZVNpZ25hdHVyZSgpLAogICAgICBdKTsKICAgICAgdmFyIGFyciA9IFtdOwogICAgICB2YXIga2V5Q29kZSA9IDA7CiAgICAgIHZhciBjaGFyQ29kZSA9IDA7CiAgICAgIHZhciBzZWVrVGltZSA9IDA7CiAgICAgIHZhciBwcmVzc1RpbWUgPSAwOwogICAgICBpZiAoc3RyICE9PSB1bmRlZmluZWQgJiYgc3RyLmxlbmd0aCA+IDAgJiYgdHlwZW9mIHN0ciA9PT0gJ3N0cmluZycpIHsKICAgICAgICB2YXIgc3RyTG93ZXIgPSBzdHIudG9Mb3dlckNhc2UoKTsKICAgICAgICB2YXIgc3RyVXBwZXIgPSBzdHIudG9VcHBlckNhc2UoKTsKICAgICAgICB2YXIgbGFzdEZvdW5kUG9zID0gW107CiAgICAgICAgdmFyIGxhc3RQb3MgPSAwOwogICAgICAgIHZhciBzdHJVcHBlckNoYXJDb2RlOwogICAgICAgIHZhciBjdXJyZW50U2Vuc2l0aXZlQ2hhckNvZGU7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIGN1cnJlbnRDaGFyQ29kZSA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgICAgICAgaWYgKCFjYXNlU2Vuc2l0aXZlKSB7CiAgICAgICAgICAgIHN0clVwcGVyQ2hhckNvZGUgPSBzdHJVcHBlci5jaGFyQ29kZUF0KGkpOwogICAgICAgICAgICBjdXJyZW50U2Vuc2l0aXZlQ2hhckNvZGUgPSAoc3RyVXBwZXJDaGFyQ29kZSAhPT0gY3VycmVudENoYXJDb2RlKSA/IHN0clVwcGVyQ2hhckNvZGUgOiBzdHJMb3dlci5jaGFyQ29kZUF0KGkpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHN0YXJ0UG9zID0gbGFzdFBvczsKICAgICAgICAgIHZhciBmaW5pc2hQb3MgPSBkaWFncmFtSGlzdG9yeUxlbmd0aDsKICAgICAgICAgIHZhciBmb3VuZCA9IGZhbHNlOwogICAgICAgICAgd2hpbGUgKGZvdW5kID09PSBmYWxzZSkgewogICAgICAgICAgICBmb3IgKHZhciBqID0gc3RhcnRQb3M7IGogPCBmaW5pc2hQb3M7IGorKykgewogICAgICAgICAgICAgIGFyciA9IHN0YWNrRGlhZ3JhbVtqXTsKICAgICAgICAgICAgICBjaGFyQ29kZSA9IGFyclszXTsKICAgICAgICAgICAgICBpZiAoY2hhckNvZGUgPT09IGN1cnJlbnRDaGFyQ29kZSB8fCAoIWNhc2VTZW5zaXRpdmUgJiYgY2hhckNvZGUgPT09IGN1cnJlbnRTZW5zaXRpdmVDaGFyQ29kZSkpIHsKICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmIChqID09PSBsYXN0UG9zKSB7CiAgICAgICAgICAgICAgICAgIGxhc3RQb3MrKzsKICAgICAgICAgICAgICAgICAgbGFzdEZvdW5kUG9zID0gW107CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBsYXN0Rm91bmRQb3MucHVzaChqKTsKICAgICAgICAgICAgICAgICAgdmFyIGxlbiA9IGxhc3RGb3VuZFBvcy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgIGlmIChsZW4gPiAxICYmIGxhc3RGb3VuZFBvc1tsZW4gLSAxXSA9PT0gbGFzdEZvdW5kUG9zW2xlbiAtIDJdICsgMSkgewogICAgICAgICAgICAgICAgICAgIGxhc3RQb3MgPSBqICsgMTsKICAgICAgICAgICAgICAgICAgICBsYXN0Rm91bmRQb3MgPSBbXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAga2V5Q29kZSA9IGFyclswXTsKICAgICAgICAgICAgICAgIHNlZWtUaW1lID0gYXJyWzFdOwogICAgICAgICAgICAgICAgcHJlc3NUaW1lID0gYXJyWzJdOwogICAgICAgICAgICAgICAgaWYgKGV4dGVuZGVkKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybkFyci5wdXNoKFtjaGFyQ29kZSwgc2Vla1RpbWUsIHByZXNzVGltZSwga2V5Q29kZSxdKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHJldHVybkFyci5wdXNoKFtzZWVrVGltZSwgcHJlc3NUaW1lLF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG1vYmlsZSA9PT0gdHJ1ZSAmJiBhcnJbNl0gIT09IHVuZGVmaW5lZCAmJiBhcnJbNl0ubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICBpZiAoVHlwaW5nRE5BLmhhc0RldmljZU1vdGlvbiAmJiBUeXBpbmdETkEuaGFzRGV2aWNlT3JpZW50YXRpb24pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoVHlwaW5nRE5BLm1vdGlvbkZpeGVkRGF0YSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgbW90aW9uQXJyLnB1c2goYXJyWzZdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKFR5cGluZ0ROQS5tb3Rpb25BcnJheURhdGEgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICAgIGtwemFBcnIucHVzaChhcnJbN10pOwogICAgICAgICAgICAgICAgICAgICAga3B4ckFyci5wdXNoKGFycls4XSk7CiAgICAgICAgICAgICAgICAgICAgICBrcHlyQXJyLnB1c2goYXJyWzldKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZm91bmQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgaWYgKHN0YXJ0UG9zICE9PSAwKSB7CiAgICAgICAgICAgICAgICBzdGFydFBvcyA9IDA7CiAgICAgICAgICAgICAgICBmaW5pc2hQb3MgPSBsYXN0UG9zOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAoVHlwaW5nRE5BLnJlcGxhY2VNaXNzaW5nS2V5cykgewogICAgICAgICAgICAgICAgICBtaXNzaW5nQ291bnQrKzsKICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBUeXBpbmdETkEuc2F2ZWRNaXNzaW5nQXZnVmFsdWVzICE9PSAnb2JqZWN0JyB8fAogICAgICAgICAgICAgICAgICAgICAgVHlwaW5nRE5BLnNhdmVkTWlzc2luZ0F2Z1ZhbHVlcy5oaXN0b3J5TGVuZ3RoICE9PSBkaWFncmFtSGlzdG9yeUxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIHZhciBoaXN0U2t0RiA9IFR5cGluZ0ROQS5tYXRoLmZvKFR5cGluZ0ROQS5oaXN0b3J5LmdldCgwLCAic2VlayIpKTsKICAgICAgICAgICAgICAgICAgICB2YXIgaGlzdFBydEYgPSBUeXBpbmdETkEubWF0aC5mbyhUeXBpbmdETkEuaGlzdG9yeS5nZXQoMCwgInByZXNzIikpOwogICAgICAgICAgICAgICAgICAgIHNlZWtUaW1lID0gTWF0aC5yb3VuZChUeXBpbmdETkEubWF0aC5hdmcoaGlzdFNrdEYpKTsKICAgICAgICAgICAgICAgICAgICBwcmVzc1RpbWUgPSBNYXRoLnJvdW5kKFR5cGluZ0ROQS5tYXRoLmF2ZyhoaXN0UHJ0RikpOwogICAgICAgICAgICAgICAgICAgIFR5cGluZ0ROQS5zYXZlZE1pc3NpbmdBdmdWYWx1ZXMgPSB7CiAgICAgICAgICAgICAgICAgICAgICBzZWVrVGltZTogc2Vla1RpbWUsCiAgICAgICAgICAgICAgICAgICAgICBwcmVzc1RpbWU6IHByZXNzVGltZSwKICAgICAgICAgICAgICAgICAgICAgIGhpc3RvcnlMZW5ndGg6IGRpYWdyYW1IaXN0b3J5TGVuZ3RoLAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2Vla1RpbWUgPSBUeXBpbmdETkEuc2F2ZWRNaXNzaW5nQXZnVmFsdWVzLnNlZWtUaW1lOwogICAgICAgICAgICAgICAgICAgIHByZXNzVGltZSA9IFR5cGluZ0ROQS5zYXZlZE1pc3NpbmdBdmdWYWx1ZXMucHJlc3NUaW1lOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHZhciBtaXNzaW5nID0gMTsKICAgICAgICAgICAgICAgICAgaWYgKGV4dGVuZGVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuQXJyLnB1c2goW2N1cnJlbnRDaGFyQ29kZSwgc2Vla1RpbWUsIHByZXNzVGltZSwgY3VycmVudENoYXJDb2RlLCBtaXNzaW5nLF0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybkFyci5wdXNoKFtzZWVrVGltZSwgcHJlc3NUaW1lLCBtaXNzaW5nLF0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChtb2JpbGUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoVHlwaW5nRE5BLm1vdGlvbkZpeGVkRGF0YSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgbW90aW9uQXJyLnB1c2goIiIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoVHlwaW5nRE5BLm1vdGlvbkFycmF5RGF0YSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAga3B6YUFyci5wdXNoKCIiKTsKICAgICAgICAgICAgICAgICAgICAgIGtweHJBcnIucHVzaCgiIik7CiAgICAgICAgICAgICAgICAgICAgICBrcHlyQXJyLnB1c2goIiIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChUeXBpbmdETkEucmVwbGFjZU1pc3NpbmdLZXlzUGVyYyA8IG1pc3NpbmdDb3VudCAqIDEwMCAvIHN0ckxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHN0YXJ0Q291bnQgPSAwOwogICAgICAgIGlmICh0eXBlb2Ygc3RyID09PSAnbnVtYmVyJykgewogICAgICAgICAgc3RhcnRDb3VudCA9IGRpYWdyYW1IaXN0b3J5TGVuZ3RoIC0gc3RyOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhcnRDb3VudCA8IDApIHsKICAgICAgICAgIHN0YXJ0Q291bnQgPSAwOwogICAgICAgIH0KICAgICAgICBmb3IgKGkgPSBzdGFydENvdW50OyBpIDwgZGlhZ3JhbUhpc3RvcnlMZW5ndGg7IGkrKykgewogICAgICAgICAgYXJyID0gc3RhY2tEaWFncmFtW2ldOwogICAgICAgICAga2V5Q29kZSA9IGFyclswXTsKICAgICAgICAgIHNlZWtUaW1lID0gYXJyWzFdOwogICAgICAgICAgcHJlc3NUaW1lID0gYXJyWzJdOwogICAgICAgICAgaWYgKGV4dGVuZGVkKSB7CiAgICAgICAgICAgIGNoYXJDb2RlID0gYXJyWzNdOwogICAgICAgICAgICByZXR1cm5BcnIucHVzaChbY2hhckNvZGUsIHNlZWtUaW1lLCBwcmVzc1RpbWUsIGtleUNvZGVdKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybkFyci5wdXNoKFtzZWVrVGltZSwgcHJlc3NUaW1lXSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobW9iaWxlID09PSB0cnVlICYmIGFycls2XSAhPT0gdW5kZWZpbmVkICYmIGFycls2XS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGlmIChUeXBpbmdETkEubW90aW9uRml4ZWREYXRhID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgbW90aW9uQXJyLnB1c2goYXJyWzZdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoVHlwaW5nRE5BLm1vdGlvbkFycmF5RGF0YSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIGtwemFBcnIucHVzaChhcnJbN10pOwogICAgICAgICAgICAgIGtweHJBcnIucHVzaChhcnJbOF0pOwogICAgICAgICAgICAgIGtweXJBcnIucHVzaChhcnJbOV0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhciByZXR1cm5TdHIgPSByZXR1cm5BcnIuam9pbigifCIpOwogICAgICBpZiAobW9iaWxlID09PSB0cnVlKSB7CiAgICAgICAgaWYgKFR5cGluZ0ROQS5tb3Rpb25GaXhlZERhdGEgPT09IHRydWUpIHsKICAgICAgICAgIHJldHVyblN0ciArPSAiIyIgKyBtb3Rpb25BcnIuam9pbigifCIpOwogICAgICAgIH0KICAgICAgICBpZiAoVHlwaW5nRE5BLm1vdGlvbkFycmF5RGF0YSA9PT0gdHJ1ZSkgewogICAgICAgICAgcmV0dXJuU3RyICs9ICIjIiArIGtwemFBcnIuam9pbigifCIpOwogICAgICAgICAgcmV0dXJuU3RyICs9ICIvIiArIGtweHJBcnIuam9pbigifCIpOwogICAgICAgICAgcmV0dXJuU3RyICs9ICIvIiArIGtweXJBcnIuam9pbigifCIpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmV0dXJuU3RyOwogICAgfQoKICAgIFR5cGluZ0ROQS5zbGljZVN0YWNrQnlUYXJnZXRJZCA9IGZ1bmN0aW9uKHN0YWNrLCB0YXJnZXRJZCkgewogICAgICB2YXIgbGVuZ3RoID0gc3RhY2subGVuZ3RoOwogICAgICB2YXIgbmV3U3RhY2sgPSBbXTsKICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGFyciA9IHN0YWNrW2ldOwogICAgICAgIGlmIChhcnJbNV0gPT09IHRhcmdldElkKSB7CiAgICAgICAgICBuZXdTdGFjay5wdXNoKGFycik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBuZXdTdGFjazsKICAgIH0KCiAgICBUeXBpbmdETkEuaGlzdG9yeS5nZXQgPSBmdW5jdGlvbihsZW5ndGgsIHR5cGUsIHRhcmdldElkKSB7CiAgICAgIHZhciBzdGFjayA9IHRoaXMuc3RhY2s7CiAgICAgIGlmICh0YXJnZXRJZCAhPT0gdW5kZWZpbmVkICYmIHRhcmdldElkICE9PSAiIiAmJiBzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgc3RhY2sgPSBUeXBpbmdETkEuc2xpY2VTdGFja0J5VGFyZ2V0SWQoc3RhY2ssIHRhcmdldElkKTsKICAgICAgfQogICAgICB2YXIgaGlzdG9yeVRvdGFsTGVuZ3RoID0gc3RhY2subGVuZ3RoOwogICAgICBpZiAobGVuZ3RoID09PSAwIHx8IGxlbmd0aCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGVuZ3RoID0gVHlwaW5nRE5BLmRlZmF1bHRIaXN0b3J5TGVuZ3RoOwogICAgICB9CiAgICAgIGlmIChsZW5ndGggPiBoaXN0b3J5VG90YWxMZW5ndGgpIHsKICAgICAgICBsZW5ndGggPSBoaXN0b3J5VG90YWxMZW5ndGg7CiAgICAgIH0KICAgICAgdmFyIHNlZWtUaW1lID0gMDsKICAgICAgdmFyIHByZXNzVGltZSA9IDA7CiAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgIGNhc2UgInNlZWsiOgogICAgICAgICAgdmFyIHNlZWtBcnIgPSBbXTsKICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDw9IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHNlZWtUaW1lID0gc3RhY2tbaGlzdG9yeVRvdGFsTGVuZ3RoIC0gaV1bMV07CiAgICAgICAgICAgIGlmIChzZWVrVGltZSA8PSBUeXBpbmdETkEubWF4U2Vla1RpbWUpIHsKICAgICAgICAgICAgICBzZWVrQXJyLnB1c2goc2Vla1RpbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgcmV0dXJuIHNlZWtBcnI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJwcmVzcyI6CiAgICAgICAgICB2YXIgcHJlc3NBcnIgPSBbXTsKICAgICAgICAgIGZvciAoaSA9IDE7IGkgPD0gbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgcHJlc3NUaW1lID0gc3RhY2tbaGlzdG9yeVRvdGFsTGVuZ3RoIC0gaV1bMl07CiAgICAgICAgICAgIGlmIChwcmVzc1RpbWUgPD0gVHlwaW5nRE5BLm1heFByZXNzVGltZSkgewogICAgICAgICAgICAgIHByZXNzQXJyLnB1c2gocHJlc3NUaW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIHJldHVybiBwcmVzc0FycjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB2YXIgaGlzdG9yeVN0YWNrT2JqID0ge307CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwga2V5Q29kZXNMZW47IGkrKykgewogICAgICAgICAgICBoaXN0b3J5U3RhY2tPYmpbVHlwaW5nRE5BLmtleUNvZGVzW2ldXSA9IFsKICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICBbXQogICAgICAgICAgICBdOwogICAgICAgICAgfQogICAgICAgICAgZm9yIChpID0gMTsgaSA8PSBsZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgYXJyID0gc3RhY2tbaGlzdG9yeVRvdGFsTGVuZ3RoIC0gaV07CiAgICAgICAgICAgIHZhciBrZXlDb2RlID0gYXJyWzBdOwogICAgICAgICAgICBzZWVrVGltZSA9IGFyclsxXTsKICAgICAgICAgICAgcHJlc3NUaW1lID0gYXJyWzJdOwogICAgICAgICAgICB2YXIgcHJldktleUNvZGUgPSBhcnJbM107CiAgICAgICAgICAgIGlmIChUeXBpbmdETkEua2V5Q29kZXNPYmpba2V5Q29kZV0pIHsKICAgICAgICAgICAgICBpZiAoc2Vla1RpbWUgPD0gVHlwaW5nRE5BLm1heFNlZWtUaW1lKSB7CiAgICAgICAgICAgICAgICBoaXN0b3J5U3RhY2tPYmpba2V5Q29kZV1bMF0ucHVzaChzZWVrVGltZSk7CiAgICAgICAgICAgICAgICBpZiAocHJldktleUNvZGUgIT09IDAgJiYgVHlwaW5nRE5BLmtleUNvZGVzT2JqW3ByZXZLZXlDb2RlXSkgewogICAgICAgICAgICAgICAgICBoaXN0b3J5U3RhY2tPYmpbcHJldktleUNvZGVdWzJdLnB1c2goc2Vla1RpbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAocHJlc3NUaW1lIDw9IFR5cGluZ0ROQS5tYXhQcmVzc1RpbWUpIHsKICAgICAgICAgICAgICAgIGhpc3RvcnlTdGFja09ialtrZXlDb2RlXVsxXS5wdXNoKHByZXNzVGltZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgcmV0dXJuIFtoaXN0b3J5U3RhY2tPYmosIGxlbmd0aF07CiAgICAgIH0KICAgIH0KCiAgICBUeXBpbmdETkEuaGlzdG9yeS5nZXRTcGVjaWFsS2V5cyA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgcmV0dXJuQXJyID0gW107CiAgICAgIHZhciBsZW5ndGggPSB0aGlzLnN0YWNrLmxlbmd0aDsKICAgICAgdmFyIGhpc3RvcnlTdGFja09iaiA9IHt9OwogICAgICB2YXIgc3BLZXlDb2Rlc0xlbiA9IFR5cGluZ0ROQS5zcEtleUNvZGVzLmxlbmd0aDsKICAgICAgdmFyIGFyciA9IHt9OwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNwS2V5Q29kZXNMZW47IGkrKykgewogICAgICAgIGhpc3RvcnlTdGFja09ialtUeXBpbmdETkEuc3BLZXlDb2Rlc1tpXV0gPSBbCiAgICAgICAgICBbXSwKICAgICAgICBdOwogICAgICB9CiAgICAgIGZvciAoaSA9IDE7IGkgPD0gbGVuZ3RoOyBpKyspIHsKICAgICAgICBhcnIgPSB0aGlzLnN0YWNrW2xlbmd0aCAtIGldOwogICAgICAgIGlmIChUeXBpbmdETkEuc3BLZXlDb2Rlc09ialthcnJbMF1dKSB7CiAgICAgICAgICB2YXIga2V5Q29kZSA9IGFyclswXTsKICAgICAgICAgIHZhciBwcmVzc1RpbWUgPSBhcnJbMl07CiAgICAgICAgICBpZiAocHJlc3NUaW1lIDw9IFR5cGluZ0ROQS5tYXhQcmVzc1RpbWUpIHsKICAgICAgICAgICAgaGlzdG9yeVN0YWNrT2JqW2tleUNvZGVdWzBdLnB1c2gocHJlc3NUaW1lKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChpID0gMDsgaSA8IHNwS2V5Q29kZXNMZW47IGkrKykgewogICAgICAgIGFyciA9IFR5cGluZ0ROQS5tYXRoLmZvKGhpc3RvcnlTdGFja09ialtUeXBpbmdETkEuc3BLZXlDb2Rlc1tpXV1bMF0pOwogICAgICAgIHZhciBhcnJMZW4gPSBhcnIubGVuZ3RoOwogICAgICAgIHJldHVybkFyci5wdXNoKGFyckxlbik7CiAgICAgICAgaWYgKGFyckxlbiA+IDEpIHsKICAgICAgICAgIHJldHVybkFyci5wdXNoKE1hdGgucm91bmQoVHlwaW5nRE5BLm1hdGguYXZnKGFycikpKTsKICAgICAgICAgIHJldHVybkFyci5wdXNoKE1hdGgucm91bmQoVHlwaW5nRE5BLm1hdGguc2QoYXJyKSkpOwogICAgICAgIH0gZWxzZSBpZiAoYXJyTGVuID09PSAxKSB7CiAgICAgICAgICByZXR1cm5BcnIucHVzaChbYXJyWzBdLCAtMSxdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuQXJyLnB1c2goWy0xLCAtMSxdKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdmFyIGNsaWNrc0FyckxlbiA9IFR5cGluZ0ROQS5jbGlja1RpbWVzLmxlbmd0aDsKICAgICAgcmV0dXJuQXJyLnB1c2goY2xpY2tzQXJyTGVuKTsKICAgICAgaWYgKGNsaWNrc0FyckxlbiA+IDEpIHsKICAgICAgICByZXR1cm5BcnIucHVzaChNYXRoLnJvdW5kKFR5cGluZ0ROQS5tYXRoLmF2ZyhUeXBpbmdETkEuY2xpY2tUaW1lcykpKTsKICAgICAgICByZXR1cm5BcnIucHVzaChNYXRoLnJvdW5kKFR5cGluZ0ROQS5tYXRoLnNkKFR5cGluZ0ROQS5jbGlja1RpbWVzKSkpOwogICAgICB9IGVsc2UgaWYgKGNsaWNrc0FyckxlbiA9PT0gMSkgewogICAgICAgIHJldHVybkFyci5wdXNoKFR5cGluZ0ROQS5jbGlja1RpbWVzWzBdLCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuQXJyLnB1c2goWy0xLCAtMV0pOwogICAgICB9CiAgICAgIHZhciBzdG9wQXJyTGVuID0gVHlwaW5nRE5BLnN0b3BUaW1lcy5sZW5ndGg7CiAgICAgIHJldHVybkFyci5wdXNoKHN0b3BBcnJMZW4pOwogICAgICBpZiAoc3RvcEFyckxlbiA+IDEpIHsKICAgICAgICByZXR1cm5BcnIucHVzaChNYXRoLnJvdW5kKFR5cGluZ0ROQS5tYXRoLmF2ZyhUeXBpbmdETkEuc3RvcFRpbWVzKSkpOwogICAgICAgIHJldHVybkFyci5wdXNoKE1hdGgucm91bmQoVHlwaW5nRE5BLm1hdGguc2QoVHlwaW5nRE5BLnN0b3BUaW1lcykpKTsKICAgICAgfSBlbHNlIGlmIChzdG9wQXJyTGVuID09PSAxKSB7CiAgICAgICAgcmV0dXJuQXJyLnB1c2goVHlwaW5nRE5BLnN0b3BUaW1lc1swXSwgLTEpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybkFyci5wdXNoKFstMSwgLTFdKTsKICAgICAgfQogICAgICByZXR1cm4gcmV0dXJuQXJyOwogICAgfQoKICAgIFR5cGluZ0ROQS5nZXRPU0Jyb3dzZXJNb2JpbGUgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHVhID0gVHlwaW5nRE5BLnVhOwogICAgICB2YXIgcGxhdGZvcm0gPSBUeXBpbmdETkEucGxhdGZvcm07CiAgICAgIHZhciBvcmllbnRhdGlvbiA9IHNjcmVlbi5oZWlnaHQgPj0gc2NyZWVuLndpZHRoOwogICAgICB2YXIgb3MgPSAwOwogICAgICB2YXIgb3N2ZXJzaW9uID0gMDsKICAgICAgdmFyIGJyb3dzZXJUeXBlID0gMDsKICAgICAgdmFyIHZlcnNpb24gPSAwOwogICAgICB2YXIgbW9iaWxlID0gMTsKICAgICAgaWYgKC9NU0lFLy50ZXN0KHVhKSkgewogICAgICAgIGJyb3dzZXJUeXBlID0gNDsKICAgICAgICBpZiAoL0lFTW9iaWxlLy50ZXN0KHVhKSkgewogICAgICAgICAgbW9iaWxlID0gMjsKICAgICAgICB9CiAgICAgICAgaWYgKC9NU0lFIFxkK1suXVxkKy8udGVzdCh1YSkpIHsKICAgICAgICAgIHZlcnNpb24gPSAvTVNJRSBcZCtbLl1cZCsvLmV4ZWModWEpWzBdLnNwbGl0KCcgJylbMV0uc3BsaXQoJy4nKVswXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoL0VkZ2UvLnRlc3QodWEpKSB7CiAgICAgICAgYnJvd3NlclR5cGUgPSA2OwogICAgICAgIGlmICgvRWRnZVwvW1xkXC5dKy8udGVzdCh1YSkpIHsKICAgICAgICAgIHZlcnNpb24gPSAvRWRnZVwvW1xkXC5dKy8uZXhlYyh1YSlbMF0uc3BsaXQoJy8nKVsxXS5zcGxpdCgnLicpWzBdOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICgvQ2hyb21lLy50ZXN0KHVhKSkgewogICAgICAgIGlmICgvQ3JPUy8udGVzdCh1YSkpIHsKICAgICAgICAgIHBsYXRmb3JtID0gJ0NyT1MnOwogICAgICAgIH0KICAgICAgICBicm93c2VyVHlwZSA9IDE7CiAgICAgICAgaWYgKC9DaHJvbWVcL1tcZFwuXSsvLnRlc3QodWEpKSB7CiAgICAgICAgICB2ZXJzaW9uID0gL0Nocm9tZVwvW1xkXC5dKy8uZXhlYyh1YSlbMF0uc3BsaXQoJy8nKVsxXS5zcGxpdCgnLicpWzBdOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICgvT3BlcmEvLnRlc3QodWEpKSB7CiAgICAgICAgYnJvd3NlclR5cGUgPSAzOwogICAgICAgIGlmICgvbWluaS8udGVzdCh1YSkgfHwgL01vYmlsZS8udGVzdCh1YSkpIHsKICAgICAgICAgIG1vYmlsZSA9IDI7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKC9BbmRyb2lkLy50ZXN0KHVhKSkgewogICAgICAgIGJyb3dzZXJUeXBlID0gNzsKICAgICAgICBtb2JpbGUgPSAyOwogICAgICAgIG9zID0gNjsKICAgICAgfSBlbHNlIGlmICgvRmlyZWZveC8udGVzdCh1YSkpIHsKICAgICAgICBicm93c2VyVHlwZSA9IDI7CiAgICAgICAgaWYgKC9GZW5uZWMvLnRlc3QodWEpKSB7CiAgICAgICAgICBtb2JpbGUgPSAyOwogICAgICAgIH0KICAgICAgICBpZiAoL0ZpcmVmb3hcL1tcLlxkXSsvLnRlc3QodWEpKSB7CiAgICAgICAgICB2ZXJzaW9uID0gL0ZpcmVmb3hcL1tcLlxkXSsvLmV4ZWModWEpWzBdLnNwbGl0KCcvJylbMV0uc3BsaXQoJy4nKVswXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoL1NhZmFyaS8udGVzdCh1YSkpIHsKICAgICAgICBicm93c2VyVHlwZSA9IDU7CiAgICAgICAgaWYgKCgvaVBob25lLy50ZXN0KHVhKSkgfHwgKC9pUGFkLy50ZXN0KHVhKSkgfHwgKC9pUG9kLy50ZXN0KHVhKSkpIHsKICAgICAgICAgIG9zID0gNTsKICAgICAgICAgIGlmICgvaVBhZC8udGVzdCh1YSkpIHsKICAgICAgICAgICAgbW9iaWxlID0gMzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1vYmlsZSA9IDI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICghdmVyc2lvbikgewogICAgICAgIGlmICgvVmVyc2lvblwvW1wuXGRdKy8udGVzdCh1YSkpIHsKICAgICAgICAgIHZlcnNpb24gPSAvVmVyc2lvblwvW1wuXGRdKy8uZXhlYyh1YSk7CiAgICAgICAgfQogICAgICAgIGlmICh2ZXJzaW9uKSB7CiAgICAgICAgICB2ZXJzaW9uID0gdmVyc2lvblswXS5zcGxpdCgnLycpWzFdLnNwbGl0KCcuJylbMF07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICgvT3BlcmFcL1tcLlxkXSsvLnRlc3QodWEpKSB7CiAgICAgICAgICAgIHZlcnNpb24gPSAvT3BlcmFcL1tcLlxkXSsvLmV4ZWModWEpWzBdLnNwbGl0KCcvJylbMV0uc3BsaXQoJy4nKVswXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHBsYXRmb3JtID09PSAnTWFjSW50ZWwnIHx8IHBsYXRmb3JtID09PSAnTWFjUFBDJykgewogICAgICAgIG9zID0gMjsKICAgICAgICBpZiAoLzEwW1wuXF9cZF0rLy50ZXN0KHVhKSkgewogICAgICAgICAgb3N2ZXJzaW9uID0gLzEwW1wuXF9cZF0rLy5leGVjKHVhKVswXS5zcGxpdCgnLicsIDIpLmpvaW4oJycpOwogICAgICAgIH0KICAgICAgICBpZiAoL1tcX10vLnRlc3Qob3N2ZXJzaW9uKSkgewogICAgICAgICAgb3N2ZXJzaW9uID0gb3N2ZXJzaW9uLnNwbGl0KCdfJykuc2xpY2UoMCwgMikuam9pbignJyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBsYXRmb3JtID09PSAnQ3JPUycpIHsKICAgICAgICBvcyA9IDQ7CiAgICAgIH0gZWxzZSBpZiAocGxhdGZvcm0gPT09ICdXaW4zMicgfHwgcGxhdGZvcm0gPT09ICdXaW42NCcpIHsKICAgICAgICBvcyA9IDE7CiAgICAgIH0gZWxzZSBpZiAoIW9zICYmIC9BbmRyb2lkLy50ZXN0KHVhKSkgewogICAgICAgIG9zID0gNjsKICAgICAgfSBlbHNlIGlmICghb3MgJiYgL0xpbnV4Ly50ZXN0KHBsYXRmb3JtKSkgewogICAgICAgIG9zID0gMzsKICAgICAgfSBlbHNlIGlmICghb3MgJiYgL1dpbmRvd3MvLnRlc3QodWEpKSB7CiAgICAgICAgb3MgPSAxOwogICAgICB9CiAgICAgIGlmICgobW9iaWxlICE9PSAzIHx8IG1vYmlsZSA9PT0gMikgJiYgVHlwaW5nRE5BLmlzTW9iaWxlKCkgPT09IDEpIHsKICAgICAgICBpZiAoLyhpcGFkfHRhYmxldHwoYW5kcm9pZCg/IS4qbW9iaWxlKSl8KHdpbmRvd3MoPyEuKnBob25lKSguKnRvdWNoKSl8a2luZGxlfHBsYXlib29rfHNpbGt8KHB1ZmZpbig/IS4qKElQfEFQfFdQKSkpKS9pLnRlc3QodWEpKSB7CiAgICAgICAgICBtb2JpbGUgPSAzOwogICAgICAgIH0gZWxzZSBpZiAoKG9zID09PSA2IHx8IG9zID09PSAwKSAmJiAoKG9yaWVudGF0aW9uICYmIHNjcmVlbi5oZWlnaHQgPiA3NjcgJiYgc2NyZWVuLndpZHRoID4gNDgwKSB8fAogICAgICAgICAgICAoIW9yaWVudGF0aW9uICYmIHNjcmVlbi53aWR0aCA+IDc2NyAmJiBzY3JlZW4uaGVpZ2h0ID4gNDgwKSkpIHsKICAgICAgICAgIG1vYmlsZSA9IDM7CiAgICAgICAgfSBlbHNlIGlmIChvcyA9PT0gMSkgewogICAgICAgICAgaWYgKHdpbmRvdy5uYXZpZ2F0b3IubXNQb2ludGVyRW5hYmxlZCAmJiBuYXZpZ2F0b3IubXNNYXhUb3VjaFBvaW50cyA+IDApIHsKICAgICAgICAgICAgbW9iaWxlID0gMzsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgbW9iaWxlID0gMjsKICAgICAgICB9CiAgICAgIH0KICAgICAgdmFyIGlzTW9iaWxlMiA9IE51bWJlcigodHlwZW9mIHdpbmRvdy5vcmllbnRhdGlvbiAhPT0gJ3VuZGVmaW5lZCcpIHx8ICh1YS5pbmRleE9mKCdJRU1vYmlsZScpICE9PSAtMSkpICsgMTsKICAgICAgdmFyIGlzVG91Y2hEZXZpY2UgPSBOdW1iZXIoJ29udG91Y2hzdGFydCcgaW4gd2luZG93IHx8IG5hdmlnYXRvci5tYXhUb3VjaFBvaW50cyB8fCB3aW5kb3cuRG9jdW1lbnRUb3VjaCAmJiBkb2N1bWVudCBpbnN0YW5jZW9mIERvY3VtZW50VG91Y2ggfHwgZmFsc2UpICsgMTsKICAgICAgcmV0dXJuIFtOdW1iZXIob3MpLCBOdW1iZXIob3N2ZXJzaW9uKSwgTnVtYmVyKGJyb3dzZXJUeXBlKSwgTnVtYmVyKHZlcnNpb24pLCBOdW1iZXIobW9iaWxlKSwgaXNNb2JpbGUyLCBOdW1iZXIob3JpZW50YXRpb24pLCBpc1RvdWNoRGV2aWNlXTsKICAgIH0KCiAgICBUeXBpbmdETkEuZ2V0RGV2aWNlU2lnbmF0dXJlID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBvc0Jyb3dzZXJNb2JpbGUgPSBUeXBpbmdETkEuZ2V0T1NCcm93c2VyTW9iaWxlKCk7CiAgICAgIHZhciBkZXZpY2VUeXBlID0gb3NCcm93c2VyTW9iaWxlWzRdOyAvLyB7MDp1bmtub3duLCAxOnBjLCAyOnBob25lLCAzOnRhYmxldH0KICAgICAgdmFyIGRldmljZU1vZGVsID0gMDsgLy8gZm52MWFIYXNoIG9mIGRldmljZSBtYW51ZmFjdHVyZXIgKyAiLSIgKyBtb2RlbAogICAgICB2YXIgZGV2aWNlSWQgPSAwOyAvLyBmbnYxYUhhc2ggb2YgZGV2aWNlIGlkCiAgICAgIHZhciBpc01vYmlsZSA9IG9zQnJvd3Nlck1vYmlsZVs1XTsgLy8gezA6dW5rbm93biwgMTpwYywgMjptb2JpbGV9CiAgICAgIHZhciBvcGVyYXRpbmdTeXN0ZW0gPSBvc0Jyb3dzZXJNb2JpbGVbMF07IC8vIHswOnVua25vd24vb3RoZXIsIDE6V2luZG93cywgMjpNYWNPUywgMzpMaW51eCwgNDpDaHJvbWVPUywgNTppT1MsIDY6IEFuZHJvaWR9CiAgICAgIHZhciBwcm9ncmFtbWluZ0xhbmd1YWdlID0gMTsgLy8gezA6dW5rbm93biwgMTpKYXZhU2NyaXB0LCAyOkphdmEsIDM6U3dpZnQsIDQ6QysrLCA1OkMjLCA2OkFuZHJvaWRKYXZhfQogICAgICB2YXIgc3lzdGVtTGFuZ3VhZ2UgPSBUeXBpbmdETkEubWF0aC5mbnYxYUhhc2gobmF2aWdhdG9yLmxhbmd1YWdlKTsgLy8gZm52MWFIYXNoIG9mIGxhbmd1YWdlCiAgICAgIHZhciBpc1RvdWNoRGV2aWNlID0gb3NCcm93c2VyTW9iaWxlWzddIC8vIHswOnVua25vd24sIDE6bm8sIDI6eWVzfQogICAgICB2YXIgcHJlc3NUeXBlID0gVHlwaW5nRE5BLmdldFByZXNzVHlwZSgpOyAvLyB7MDp1bmtub3duLCAxOnJlY29yZGVkLCAyOmNhbGN1bGF0ZWQsIDM6bWl4ZWR9CiAgICAgIHZhciBrZXlib2FyZElucHV0ID0gMDsgLy8gezA6dW5rbm93biwgMTprZXlib2FyZCwgMjp0b3VjaHNjcmVlbiwgMzptaXhlZH0KICAgICAgdmFyIGtleWJvYXJkVHlwZSA9IDA7IC8vIHswOnVua25vd24sIDE6aW50ZXJuYWwsIDI6ZXh0ZXJuYWwsIDM6bWl4ZWR9CiAgICAgIHZhciBwb2ludGVySW5wdXQgPSAwOyAvLyB7MDp1bmtub3duLCAxOm1vdXNlLCAyOnRvdWNoc2NyZWVuLCAzOnRyYWNrcGFkLCA0Om90aGVyLCA1Om1peGVkfQogICAgICB2YXIgYnJvd3NlclR5cGUgPSBvc0Jyb3dzZXJNb2JpbGVbMl07IC8vIHswOnVua25vd24sIDE6Q2hyb21lLCAyOkZpcmVmb3gsIDM6T3BlcmEsIDQ6SUUsIDU6IFNhZmFyaSwgNjogRWRnZSwgNzpBbmRyb2lkV0t9CiAgICAgIHZhciBkaXNwbGF5V2lkdGggPSBzY3JlZW4ud2lkdGggfHwgMDsgLy8gc2NyZWVuIHdpZHRoIGluIHBpeGVscwogICAgICB2YXIgZGlzcGxheUhlaWdodCA9IHNjcmVlbi5oZWlnaHQgfHwgMDsgLy8gc2NyZWVuIGhlaWdodCBpbiBwaXhlbHMKICAgICAgdmFyIG9yaWVudGF0aW9uID0gb3NCcm93c2VyTW9iaWxlWzZdID8gMSA6IDI7Ly8gezA6dW5rbm93biwgMTpwb3J0cmFpdCwgMjpsYW5kc2NhcGV9CiAgICAgIHZhciBvc1ZlcnNpb24gPSBvc0Jyb3dzZXJNb2JpbGVbMV07IC8vIG51bWJlcnMgb25seQogICAgICB2YXIgYnJvd3NlclZlcnNpb24gPSBvc0Jyb3dzZXJNb2JpbGVbM107IC8vIG51bWJlcnMgb25seQogICAgICB2YXIgY29va2llSWQgPSBUeXBpbmdETkEuY29va2llSWQ7IC8vIGRlZmF1bHQgMAogICAgICB2YXIgc2lnbmF0dXJlID0gVHlwaW5nRE5BLm1hdGguZm52MWFIYXNoKFtkZXZpY2VUeXBlLCBkZXZpY2VNb2RlbCwgZGV2aWNlSWQsIGlzTW9iaWxlLCBvcGVyYXRpbmdTeXN0ZW0sIHByb2dyYW1taW5nTGFuZ3VhZ2UsIHN5c3RlbUxhbmd1YWdlLCBpc1RvdWNoRGV2aWNlLCBwcmVzc1R5cGUsCiAgICAgICAga2V5Ym9hcmRJbnB1dCwga2V5Ym9hcmRUeXBlLCBwb2ludGVySW5wdXQsIGJyb3dzZXJUeXBlLCBkaXNwbGF5V2lkdGgsIGRpc3BsYXlIZWlnaHQsIG9yaWVudGF0aW9uLCBvc1ZlcnNpb24sIGJyb3dzZXJWZXJzaW9uLCBjb29raWVJZAogICAgICBdLmpvaW4oJy0nKSk7IC8vIGZudjFhSGFzaCBvZiBhbGwgYWJvdmUhCiAgICAgIHJldHVybiBbZGV2aWNlVHlwZSwgZGV2aWNlTW9kZWwsIGRldmljZUlkLCBpc01vYmlsZSwgb3BlcmF0aW5nU3lzdGVtLCBwcm9ncmFtbWluZ0xhbmd1YWdlLCBzeXN0ZW1MYW5ndWFnZSwgaXNUb3VjaERldmljZSwgcHJlc3NUeXBlLAogICAgICAgIGtleWJvYXJkSW5wdXQsIGtleWJvYXJkVHlwZSwgcG9pbnRlcklucHV0LCBicm93c2VyVHlwZSwgZGlzcGxheVdpZHRoLCBkaXNwbGF5SGVpZ2h0LCBvcmllbnRhdGlvbiwgb3NWZXJzaW9uLCBicm93c2VyVmVyc2lvbiwgY29va2llSWQsIHNpZ25hdHVyZQogICAgICBdOwogICAgfQoKICAgIFR5cGluZ0ROQS5nZXRQcmVzc1R5cGUgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKFR5cGluZ0ROQS5pc01vYmlsZSgpID09PSAwKSB7CiAgICAgICAgVHlwaW5nRE5BLnByZXNzUmVjb3JkZWQgPT09IHRydWU7CiAgICAgICAgcmV0dXJuIDE7IC8vIGRlc2t0b3AgYnJvd3NlciAodHlwaWNhbHkpCiAgICAgIH0KICAgICAgaWYgKFR5cGluZ0ROQS5wcmVzc0NhbGN1bGF0ZWQgPT09IHRydWUpIHsKICAgICAgICBpZiAoVHlwaW5nRE5BLnByZXNzUmVjb3JkZWQgPT09IHRydWUpIHsKICAgICAgICAgIHJldHVybiAzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gMjsgLy8gbW9iaWxlIGJyb3dzZXIgKHR5cGljYWx5KQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChUeXBpbmdETkEucHJlc3NSZWNvcmRlZCA9PT0gdHJ1ZSkgewogICAgICAgIHJldHVybiAxOyAvLyBtb2JpbGUgYXBwICh0eXBpY2FseSkKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gMDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVja3MgdGhlIHF1YWxpdHkgb2YgYSB0eXBpbmcgcGF0dGVybiB0eXBlIDAsIGhvdyB3ZWxsIGl0IGlzIHJldmVsYXRlZCwgaG93IHVzZWZ1bCB0aGUKICAgICAqIGluZm9ybWF0aW9uIHdpbGwgYmUgZm9yIG1hdGNoaW5nIGFwcGxpY2F0aW9ucy4gSXQgcmV0dXJucyBhIHZhbHVlIGJldHdlZW4gMCBhbmQgMS4KICAgICAqIFZhbHVlcyBvdmVyIDAuMyBhcmUgYWNjZXB0YWJsZSwgaG93ZXZlciBhIHZhbHVlIG92ZXIgMC43IHNob3dzIGdvb2QgcGF0dGVybiBzdHJlbmd0aC4KICAgICAqIEBwYXJhbSAge1N0cmluZ30gdHlwaW5nUGF0dGVybiBUaGUgdHlwaW5nIHBhdHRlcm4gc3RyaW5nIHJldHVybmVkIGJ5IHRoZSBnZXRUeXBpbmdQYXR0ZXJuKHt0eXBlOjB9KSBmdW5jdGlvbi4KICAgICAqIEByZXR1cm4ge051bWJlcn0gQSByZWFsIG51bWJlciBiZXR3ZWVuIDAgYW5kIDEuIEEgY2xvc2UgdG8gMSB2YWx1ZSBtZWFucyBhIHN0cm9uZ2VyIHBhdHRlcm4uCiAgICAgKiBAZXhhbXBsZSB2YXIgcXVhbGl0eSA9IHRkbmEuZ2V0UXVhbGl0eSh0eXBpbmdQYXR0ZXJuKTsKICAgICAqLwogICAgVHlwaW5nRE5BLmdldFF1YWxpdHkgPSBmdW5jdGlvbih0eXBpbmdQYXR0ZXJuKSB7CiAgICAgIHZhciBvYmogPSB0eXBpbmdQYXR0ZXJuLnNwbGl0KCIsIik7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgb2JqW2ldID0gTnVtYmVyKG9ialtpXSk7CiAgICAgIH0KICAgICAgdmFyIGFjYyA9IDA7CiAgICAgIHZhciByZWMgPSAwOwogICAgICB2YXIgYXZnQWNjID0gMDsKICAgICAgdmFyIHJldnMgPSBvYmouc2xpY2UoMTEsIDU1KTsKICAgICAgdmFyIGF2ZyA9IFR5cGluZ0ROQS5tYXRoLmF2ZyhyZXZzKTsKICAgICAgdmFyIHJldnNMZW4gPSByZXZzLmxlbmd0aDsKICAgICAgZm9yIChpID0gMDsgaSA8IHJldnNMZW47IGkrKykgewogICAgICAgIHJlYyArPSBOdW1iZXIocmV2c1tpXSA+IDApOwogICAgICAgIGFjYyArPSBOdW1iZXIocmV2c1tpXSA+IDQpOwogICAgICAgIGF2Z0FjYyArPSBOdW1iZXIocmV2c1tpXSA+IGF2Zyk7CiAgICAgIH0KICAgICAgdmFyIHRSZXR1cm4gPSBNYXRoLnNxcnQocmVjICogYWNjICogYXZnQWNjKSAvIDc1OwogICAgICByZXR1cm4gdFJldHVybiA+IDEgPyAxIDogdFJldHVybjsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrcyB0aGUgdmFsaWRpdHkgb2YgYSB0eXBpbmcgcGF0dGVybiBpZiByZWNvcmRlZCBvbiBtb2JpbGUuCiAgICAgKiBAcGFyYW0gIHtTdHJpbmd9IHR5cGluZ1BhdHRlcm4gVGhlIHR5cGluZyBwYXR0ZXJuIHN0cmluZyByZXR1cm5lZCBieSB0aGUgZ2V0VHlwaW5nUGF0dGVybih7dHlwZTowfSkgZnVuY3Rpb24uCiAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IEEgcmVhbCBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiBBIG51bWJlciBsYXJnZXIgdGhhbiAwLjcgdXN1YWxseSBtZWFucyBhIHZhbGlkIHBhdHRlcm4uCiAgICAgKiBAZXhhbXBsZSB2YXIgcXVhbGl0eSA9IHRkbmEuY2hlY2tNb2JpbGVWYWxpZGl0eSh0eXBpbmdQYXR0ZXJuKTsKICAgICAqLwogICAgVHlwaW5nRE5BLmNoZWNrTW9iaWxlVmFsaWRpdHkgPSBmdW5jdGlvbih0eXBpbmdQYXR0ZXJuKSB7CiAgICAgIHZhciBvYmogPSB0eXBpbmdQYXR0ZXJuLnNwbGl0KCcsJyk7CiAgICAgIHZhciB0b3RhbEV2ZW50cyA9IG9ialswXTsKICAgICAgaWYgKHRvdGFsRXZlbnRzID09PSAwKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgICAgdmFyIHJlYyA9IDA7CiAgICAgIHZhciByZXZzID0gb2JqLnNsaWNlKDExLCA1NSk7CiAgICAgIHZhciByZXZzTGVuID0gcmV2cy5sZW5ndGg7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmV2c0xlbjsgaSsrKSB7CiAgICAgICAgcmVjICs9IE51bWJlcihyZXZzW2ldKTsKICAgICAgfQogICAgICByZXR1cm4gcmVjIC8gdG90YWxFdmVudHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBsZW5ndGggb2YgdGhlIHR5cGluZyBwYXR0ZXJuLgogICAgICogQHBhcmFtICB7U3RyaW5nfSB0eXBpbmdQYXR0ZXJuIFRoZSB0eXBpbmcgcGF0dGVybiBzdHJpbmcgcmV0dXJuZWQgYnkgdGhlIGdldCgpIGZ1bmN0aW9uLgogICAgICogQHJldHVybiB7TnVtYmVyfSAwIGlmIHRoZSB0eXBpbmcgcGF0dGVybiBpcyBub3QgYSB2YWxpZCBwYXR0ZXJuLiBBIG51bWJlciBncmVhdGVyIHRoYW4gMCwgb3RoZXJ3aXNlLgogICAgICogQGV4YW1wbGUgdmFyIGxlbmd0aCA9IHRkbmEuZ2V0TGVuZ3RoKCIwLDMuMiwwLDAsMSwxMDkxNTQ1NTY4LDAsLTEsLTEsMCwtMSwtMSwwLC0xLC0xLDIsNzYsMTMsMiwxMDUsNDQsMSwwLDAsMSwxLDEsOTAyMjQ4MTgyLDExLDEsMCwwLDAsMSwyMDQ4LDExNTIsMSwwLDc2LDAsMjA1MzUwNjQxOXwxMzQzNiwxMDEiKTsKICAgICAqLwogICAgVHlwaW5nRE5BLmdldExlbmd0aCA9IGZ1bmN0aW9uKHR5cGluZ1BhdHRlcm4pIHsKICAgICAgaWYodHlwaW5nUGF0dGVybiAmJiB0eXBlb2YgdHlwaW5nUGF0dGVybiA9PT0gJ3N0cmluZycpIHsKICAgICAgICB2YXIgc2VwYXJhdG9ySW5kZXggPSB0eXBpbmdQYXR0ZXJuLmluZGV4T2YoJ3wnKTsKICAgICAgICBpZihzZXBhcmF0b3JJbmRleCA+IDApIHsKICAgICAgICAgIHJldHVybiBOdW1iZXIodHlwaW5nUGF0dGVybi5zdWJzdHJpbmcoMCxzZXBhcmF0b3JJbmRleCkuc3BsaXQoJywnKVs0XSkgfHwgMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIE51bWJlcih0eXBpbmdQYXR0ZXJuLnNwbGl0KCcsJylbMF0pIHx8IDA7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiAwOwogICAgfQoKICAgIC8qKgogICAgICogQ2FsY3VsYXRlcyBhIDMyLWJpdCBGTlYtMWEgaGFzaCBvbiB0aGUgc3RyaW5nIHByb3ZpZGVkCiAgICAgKiBAcGFyYW0gIHtTdHJpbmd9IHN0ciBUaGUgc3RyaW5nIGZvciB3aGljaCB0aGUgdGV4dElkIGlzIGNhbGN1bGF0ZWQuIFVzdWFsbHkgdGhlIHRleHQgYmVpbmcgdHlwZWQuCiAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IFRoZSBoYXNoIG9mIHRoZSBzdHJpbmcgcHJvdmlkZWQgYXMgcGFyYW0uCiAgICAgKiBAZXhhbXBsZSB2YXIgdGV4dElkID0gdGRuYS5nZXRUZXh0SWQoIkkgdHlwZSB0byBiZSBhdXRoZW50aWNhdGVkIik7CiAgICAgKi8KICAgIFR5cGluZ0ROQS5nZXRUZXh0SWQgPSBmdW5jdGlvbihzdHIpIHsKICAgICAgcmV0dXJuIFR5cGluZ0ROQS5tYXRoLmZudjFhSGFzaChzdHIpOwogICAgfQogIH0gZWxzZSB7CiAgICAvLyBUeXBpbmdETkEgaXMgYSBzdGF0aWMgY2xhc3MsIGN1cnJlbnRseSBkb2Vzbid0IHN1cHBvcnQgYWN0dWFsIG11bHRpcGxlIGluc3RhbmNlcyAoU2luZ2xldG9uIGltcGxlbWVudGF0aW9uKQogICAgcmV0dXJuIFR5cGluZ0ROQS5pbnN0YW5jZTsKICB9Cn0=",
      "default": false,
      "language": "JAVASCRIPT",
      "context": "AUTHENTICATION_CLIENT_SIDE",
      "createdBy": "null",
      "creationDate": 0,
      "lastModifiedBy": "null",
      "lastModifiedDate": 0
    }
  },
  "tree": {
    "_id": "TypingDNA-UsernamePassword",
    "entryNodeId": "39b25c55-376d-4ca6-91e5-ffce265f54fd",
    "staticNodes": {
      "startNode": {
        "x": 50,
        "y": 98.46945381164551
      },
      "70e691a5-1e33-4ac3-a356-e7b6d60d92e0": {
        "x": 801.1079902648926,
        "y": 131.96022033691406
      },
      "e301438c-0bd0-429c-ab0c-66126501069a": {
        "x": 801.1079902648926,
        "y": 64.97868728637695
      }
    },
    "uiConfig": {},
    "nodes": {
      "1509e9a2-bd21-4d29-9e05-d2a33e673cd5": {
        "displayName": "Data Store Decision",
        "nodeType": "DataStoreDecisionNode",
        "x": 367.24431228637695,
        "y": 75.82740783691406,
        "connections": {
          "false": "e301438c-0bd0-429c-ab0c-66126501069a",
          "true": "8b858eb1-b906-4cbe-b694-e35476e46425"
        }
      },
      "39b25c55-376d-4ca6-91e5-ffce265f54fd": {
        "displayName": "LogIn Page",
        "nodeType": "PageNode",
        "x": 152,
        "y": 25,
        "connections": {
          "outcome": "1509e9a2-bd21-4d29-9e05-d2a33e673cd5"
        }
      },
      "8b858eb1-b906-4cbe-b694-e35476e46425": {
        "displayName": "TypingDNA Decision Node",
        "nodeType": "TypingDNADecisionNode",
        "x": 563.6931648254395,
        "y": 41.537635803222656,
        "connections": {
          "ENROLL": "39b25c55-376d-4ca6-91e5-ffce265f54fd",
          "INITIAL_ENROLLMENT_COMPLETE": "39b25c55-376d-4ca6-91e5-ffce265f54fd",
          "RETRY": "39b25c55-376d-4ca6-91e5-ffce265f54fd",
          "MATCH": "70e691a5-1e33-4ac3-a356-e7b6d60d92e0",
          "NO_MATCH": "e301438c-0bd0-429c-ab0c-66126501069a",
          "FAIL": "e301438c-0bd0-429c-ab0c-66126501069a"
        }
      }
    }
  }
}
